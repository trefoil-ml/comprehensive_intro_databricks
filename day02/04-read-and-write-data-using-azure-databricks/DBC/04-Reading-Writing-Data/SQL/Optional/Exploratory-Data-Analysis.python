{"version":"NotebookV1","origId":1745794912676472,"name":"Exploratory-Data-Analysis","language":"python","commands":[{"version":"CommandV1","origId":1745794912676473,"guid":"84edfb6a-4044-415e-a995-489381c61bb4","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Project: Exploratory Data Analysis\nPerform exploratory data analysis (EDA) to gain insights from a data lake.\n\n## Instructions\n\nIn `dbfs:/mnt/training/crime-data-2016`, there are a number of Parquet files containing 2016 crime data from seven United States cities:\n\n* New York\n* Los Angeles\n* Chicago\n* Philadelphia\n* Dallas\n* Boston\n\nThe data is cleaned up a little, but has not been normalized. Each city reports crime data slightly differently, so\nexamine the data for each city to determine how to query it properly.\n\nYour job is to use some of this data to gain insights about certain kinds of crimes.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5d1a4a77-9a96-4841-8a12-cd5d30241e0d"},{"version":"CommandV1","origId":1745794912676474,"guid":"2ec30b84-c104-4ffc-a381-aca84fe835b8","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n### Getting Started\n\nRun the following cell to configure our \"classroom.\"","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"95f8f462-9579-4bd3-9d3f-d9c0d722ee12"},{"version":"CommandV1","origId":1745794912676475,"guid":"121ea343-c29f-4f74-81c6-350d154e1fa8","subtype":"command","commandType":"auto","position":4.0,"command":"%run ../Includes/Classroom-Setup","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e3181cf3-3e7a-4008-a41c-537ad54f0d6d"},{"version":"CommandV1","origId":1745794912676476,"guid":"10c5acc0-cc63-4e4e-9b76-ad2ae8d2931c","subtype":"command","commandType":"auto","position":5.0,"command":"%md-sandbox\n## Step 1\n\nStart by creating temporary views for Los Angeles, Philadelphia, and Dallas\n\nUse `CREATE TEMPORARY VIEW` to create named views for the files you choose. Use a similar syntax as `CREATE TABLE`:\n\n```\nCREATE OR REPLACE TEMPORARY VIEW name\n  USING parquet\n  OPTIONS (\n    ...\n  )\n```\n\nUse the following view names:\n\n| City          | Table Name              | Path to DBFS file\n| ------------- | ----------------------- | -----------------\n| Los Angeles   | `CrimeDataLosAngeles`   | `dbfs:/mnt/training/crime-data-2016/Crime-Data-Los-Angeles-2016.parquet`\n| Philadelphia  | `CrimeDataPhiladelphia` | `dbfs:/mnt/training/crime-data-2016/Crime-Data-Philadelphia-2016.parquet`\n| Dallas        | `CrimeDataDallas`       | `dbfs:/mnt/training/crime-data-2016/Crime-Data-Dallas-2016.parquet`\n\n\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** You learned how to create a table from an external file in [Lesson 3]($./03-Accessing-Data). The syntax is exactly the same, except that you use `CREATE OR REPLACE TEMPORARY VIEW` instead of `CREATE TABLE IF EXISTS`.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3eed13f9-99ab-47e0-9403-9fd0aed89a8d"},{"version":"CommandV1","origId":1745794912676477,"guid":"d39fd182-2f9a-4b4e-ad37-be1bffc7a60b","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"eb61b5cf-6070-4ed9-b76a-b9bffec0d87e"},{"version":"CommandV1","origId":1745794912676478,"guid":"a5647e2a-b3f0-47bd-8acd-a2bc4d3bb881","subtype":"command","commandType":"auto","position":7.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"af77350e-e710-4559-b991-a8cc9dda149b"},{"version":"CommandV1","origId":1745794912676479,"guid":"23531d2a-dfe1-4a9c-a74b-5c6159fa5ffe","subtype":"command","commandType":"auto","position":8.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nrowsLosAngeles = spark.sql('SELECT count(*) FROM CrimeDataLosAngeles').collect()[0][0]\ndbTest(\"SQL-L7-crimeDataLA-count\", 217945, rowsLosAngeles)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"030ed86f-bc3a-4eb9-91d6-f7ceff8ecedb"},{"version":"CommandV1","origId":1745794912676480,"guid":"3fbc87ee-3827-4827-89bc-e8e0ff95daa3","subtype":"command","commandType":"auto","position":9.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f90cdf24-aa12-4030-8862-b067bd2da15e"},{"version":"CommandV1","origId":1745794912676481,"guid":"8a8118c2-942a-4f90-914e-120551051345","subtype":"command","commandType":"auto","position":10.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"81b6d187-8368-43c0-ba0e-8fb8f6503c98"},{"version":"CommandV1","origId":1745794912676482,"guid":"045069e3-807a-466c-9ad9-ac38fc657a92","subtype":"command","commandType":"auto","position":11.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nrowsPhiladelphia = spark.sql('SELECT count(*) FROM CrimeDataPhiladelphia').collect()[0][0]\ndbTest(\"SQL-L7-crimeDataPA-count\", 168664, rowsPhiladelphia)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8cfa7856-9116-4d9f-8cf1-d2a4e22e856b"},{"version":"CommandV1","origId":1745794912676483,"guid":"25d93afe-05c6-4348-bc4c-4a819cf517b3","subtype":"command","commandType":"auto","position":12.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5e01f24a-20d2-460f-bb6f-ebd61662a86e"},{"version":"CommandV1","origId":1745794912676484,"guid":"1c977676-cccc-4126-a1f1-3ebbf8339ee6","subtype":"command","commandType":"auto","position":13.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7f9030c6-232e-4945-9162-7846cc38544f"},{"version":"CommandV1","origId":1745794912676485,"guid":"db01f720-aa1d-4ab2-8412-a4704a343d9e","subtype":"command","commandType":"auto","position":14.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nrowsDallas = spark.sql('SELECT count(*) FROM CrimeDataDallas').collect()[0][0]\ndbTest(\"SQL-L7-crimeDataDAL-count\", 99642, rowsDallas) \n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bb54febe-ea08-461b-98a8-b62b3da7f029"},{"version":"CommandV1","origId":1745794912676486,"guid":"aeb31380-c327-4f46-b350-0089ef2b5232","subtype":"command","commandType":"auto","position":15.0,"command":"%md-sandbox\n## Step 2\n\nFor each table, examine the data to figure out how to extract _robbery_ statistics.\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> Each city uses different values to indicate robbery. Some cities use \"larceny\", \"burglary\", and \"robbery\".  These challenges are common in data lakes.  Restrict yourself to only robberies.\n\nExplore the data for the three cities until you understand how each city records robbery information. If you don't want to worry about upper- or lower-case, remember that SQL has a `LOWER()` function that converts a column's value to lowercase.\n\nCreate a temporary view containing only the robbery-related rows, as shown in the table below.\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** For each table, focus your efforts on the column listed below.\n\nFocus on the following columns for each table:\n\n| Table Name              | Robbery View Name     | Column\n| ----------------------- | ----------------------- | -------------------------------\n| `CrimeDataLosAngeles`   | `RobberyLosAngeles`   | `crimeCodeDescription`\n| `CrimeDataPhiladelphia` | `RobberyPhiladelphia` | `ucr_general_description`\n| `CrimeDataDallas`       | `RobberyDallas`       | `typeOfIncident`","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"92f4a8e3-3cc3-400c-8f68-d80a2349e017"},{"version":"CommandV1","origId":1745794912676487,"guid":"c171dd66-022f-4469-bdc9-8e8893c8e961","subtype":"command","commandType":"auto","position":16.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b8eb41ac-07a8-49e4-89d3-9d12dd9d3343"},{"version":"CommandV1","origId":1745794912676488,"guid":"ebb0311e-c72e-4a26-8fbf-a4b56935a945","subtype":"command","commandType":"auto","position":17.0,"command":"%sql\n-- TODO\n\n-- Los Angeles\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e6e5aa5b-f733-4cc4-b1e7-b62aa3f0e023"},{"version":"CommandV1","origId":1745794912676489,"guid":"ffa551eb-a339-48e6-a12c-c8f087d684e1","subtype":"command","commandType":"auto","position":18.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\ntotalLosAngeles = spark.sql(\"SELECT count(*) AS total FROM RobberyLosAngeles\").collect()[0].total\ndbTest(\"SQL-L7-robberyDataLA-count\", 9048, totalLosAngeles)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c112b2d1-038c-48b2-9a24-68781ead18fc"},{"version":"CommandV1","origId":1745794912676490,"guid":"d9265ce3-7cd3-4ecf-a466-640709e07e52","subtype":"command","commandType":"auto","position":19.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"be69cb5e-e07d-44be-aff6-ace24c856e2d"},{"version":"CommandV1","origId":1745794912676491,"guid":"40421528-4666-4aac-b6fc-fd488868f419","subtype":"command","commandType":"auto","position":20.0,"command":"%sql\n-- TODO\n\n-- Philadelphia\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2b66d12a-e516-4321-ad93-f2c72a589bf8"},{"version":"CommandV1","origId":1745794912676492,"guid":"dd41f519-4172-44d4-b367-177ff9ee3f13","subtype":"command","commandType":"auto","position":21.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\ntotalPhiladelphia = spark.sql(\"SELECT count(*) AS total FROM RobberyPhiladelphia\").collect()[0].total\ndbTest(\"SQL-L7-robberyDataPA-count\", 6149, totalPhiladelphia)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e627f4e5-1c12-4446-adfe-b6bb6aaa91dd"},{"version":"CommandV1","origId":1745794912676493,"guid":"67770c4b-55e5-4495-8e81-15c647e88b69","subtype":"command","commandType":"auto","position":22.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4df3a9ab-f5bf-48ad-8d96-984cb88962ec"},{"version":"CommandV1","origId":1745794912676494,"guid":"353bee6a-8319-41fb-ba81-8972d10fc124","subtype":"command","commandType":"auto","position":23.0,"command":"%sql\n-- TODO\n\n-- Dallas\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"08d25ed0-ad81-466e-96c8-0ee794c90428"},{"version":"CommandV1","origId":1745794912676495,"guid":"0777fa7a-9939-4c73-ac46-b945ee9d9081","subtype":"command","commandType":"auto","position":24.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\ntotalDallas = spark.sql(\"SELECT count(*) AS total FROM RobberyDallas\").collect()[0].total\ndbTest(\"SQL-L7-robberyDataDAL-count\", 6824, totalDallas)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"da1ffd22-f2ae-4df0-b914-7030647038e5"},{"version":"CommandV1","origId":1745794912676496,"guid":"f6001067-efae-497a-bd15-5145990722fd","subtype":"command","commandType":"auto","position":25.0,"command":"%md-sandbox\n## Step 3\n\nNow that you have views of only the robberies in each city, create temporary views for each city, summarizing the number of robberies in each month.\n\nYour views must contain two columns:\n* `month`: The month number (e.g., 1 for January, 2 for February, etc.)\n* `robberies`: The total number of robberies in the month\n\nUse the following temporary view names and date columns:\n\n\n| City          | View Name     | Date Column \n| ------------- | ------------- | -------------\n| Los Angeles   | `RobberiesByMonthLosAngeles` | `timeOccurred`\n| Philadelphia  | `RobberiesByMonthPhiladelphia` | `dispatch_date_time`\n| Dallas        | `RobberiesByMonthDallas` | `startingDateTime`\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> For each city, figure out which column contains the date of the incident. Then, extract the month from that date.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cbe2f100-7623-4fa3-b7a1-4a890600f083"},{"version":"CommandV1","origId":1745794912676497,"guid":"3e0a900c-884b-4eca-a880-dd35c69a6cd3","subtype":"command","commandType":"auto","position":26.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1c199770-57f2-413d-be70-e7b5dbc617df"},{"version":"CommandV1","origId":1745794912676498,"guid":"768c92e1-a1e6-425a-9608-422116a764fe","subtype":"command","commandType":"auto","position":27.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e520ccf5-c546-4dc1-a3af-606fdf185978"},{"version":"CommandV1","origId":1745794912676499,"guid":"61e61eeb-61bd-4e1c-ae7e-becb4a5add0c","subtype":"command","commandType":"auto","position":28.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nla = { r.month : r.robberies for r in spark.sql(\"SELECT * FROM RobberiesByMonthLosAngeles\").collect() }\ndbTest(\"SQL-L7-robberyByMonthLA-counts\", {1: 719, 2: 675, 3: 709, 4: 713, 5: 790, 6: 698, 7: 826, 8: 765, 9: 722, 10: 814, 11: 764, 12: 853}, la)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5a861d16-6d09-4f98-ba57-d798295182ae"},{"version":"CommandV1","origId":1745794912676500,"guid":"8b9a1b65-69b0-4a98-9ee2-ab958fcb1f79","subtype":"command","commandType":"auto","position":29.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c3d4bad5-f6a4-4cd7-8076-300f47c5b5bb"},{"version":"CommandV1","origId":1745794912676501,"guid":"91421394-2871-44c7-beb9-5e511461a63c","subtype":"command","commandType":"auto","position":30.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ce2af855-77c2-418d-9e54-01db784a6058"},{"version":"CommandV1","origId":1745794912676502,"guid":"da37fafe-0a45-43d7-9d4e-7670cc00f6d6","subtype":"command","commandType":"auto","position":31.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nphiladelphia = { r.month : r.robberies for r in spark.sql(\"SELECT * FROM RobberiesByMonthPhiladelphia\").collect() }\ndbTest(\"SQL-L7-robberyByMonthPA-counts\", {1: 520, 2: 416, 3: 432, 4: 466, 5: 533, 6: 509, 7: 537, 8: 561, 9: 514, 10: 572, 11: 545, 12: 544}, philadelphia)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f7bce7a5-2bc0-4f60-b299-71e29c8bd34e"},{"version":"CommandV1","origId":1745794912676503,"guid":"aa9a680c-71dd-41c1-b0ed-3c8c1ed75bd4","subtype":"command","commandType":"auto","position":32.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"39458c8c-5c41-4f65-9229-cd9a51f4ffa7"},{"version":"CommandV1","origId":1745794912676504,"guid":"c5d2b3e8-4fad-45c6-b832-7a8235426c4f","subtype":"command","commandType":"auto","position":33.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6ac68474-9650-4895-ba75-6835ddceb2e8"},{"version":"CommandV1","origId":1745794912676505,"guid":"68c310f3-e485-4ccc-bdcd-53f20cb6d7d4","subtype":"command","commandType":"auto","position":34.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\ndallas = { r.month : r.robberies for r in spark.sql(\"SELECT * FROM RobberiesByMonthDallas\").collect() }\ndbTest(\"SQL-L7-robberyByMonthDAL-counts\", {1: 743, 2: 435, 3: 412, 4: 594, 5: 615, 6: 495, 7: 535, 8: 627, 9: 512, 10: 603, 11: 589, 12: 664}, dallas)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"16adbcf1-ef16-4777-9a6c-73a9ec7909a2"},{"version":"CommandV1","origId":1745794912676506,"guid":"b8b1f9a9-9731-4b1a-92f3-fc8ef3bdfaf2","subtype":"command","commandType":"auto","position":35.0,"command":"%md-sandbox\n\n## Step 4\n\nPlot the robberies per month for each of your three cities, producing a plot similar to the following:\n\n<img src=\"https://files.training.databricks.com/images/eLearning/robberies-by-month.png\" style=\"max-width: 700px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n\nWhen you first run your cell, you'll get an HTML table as the result. To configure the plot,\n\n1. Click the graph button\n2. If the plot doesn't look correct, click the **Plot Options** button\n3. Configure the plot similar to the following example\n\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-1.png\" style=\"width: 440px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-2.png\" style=\"width: 268px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-3.png\" style=\"width: 362px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8f548688-74ba-4482-b724-2a188604ece6"},{"version":"CommandV1","origId":1745794912676507,"guid":"027fe846-cd54-4ac6-a75e-6e41c7cdef49","subtype":"command","commandType":"auto","position":36.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"016e7379-f3e0-459c-a6c9-1a2301b295b6"},{"version":"CommandV1","origId":1745794912676508,"guid":"8d59ec5c-b0fc-4936-8ff9-314bb401fc89","subtype":"command","commandType":"auto","position":37.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b8b1e530-bb4d-41b1-b437-309c9c265f50"},{"version":"CommandV1","origId":1745794912676509,"guid":"cb942356-6e72-4867-84c1-b44cfba9e87e","subtype":"command","commandType":"auto","position":38.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fc82423a-9827-49b2-81f1-417ed0798e72"},{"version":"CommandV1","origId":1745794912676510,"guid":"f1e180b4-00fd-4535-9363-85d05924ebc6","subtype":"command","commandType":"auto","position":39.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7e64d689-fcbc-42d1-b4f2-1ab97b7f41f3"},{"version":"CommandV1","origId":1745794912676511,"guid":"3848efb0-0689-4509-b970-53943054f01d","subtype":"command","commandType":"auto","position":40.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f79f9e41-a854-4d07-a164-5d2ce5f78697"},{"version":"CommandV1","origId":1745794912676512,"guid":"94dd0919-6ee8-4a2d-b27e-85302d569397","subtype":"command","commandType":"auto","position":41.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"10a5e280-5a47-44ba-81e6-8a23068691e6"},{"version":"CommandV1","origId":1745794912676513,"guid":"358840d3-6c2d-4d27-83ba-68496e48956d","subtype":"command","commandType":"auto","position":42.0,"command":"%md-sandbox\n## Step 5\n\nCreate another temporary view called `CombinedRobberiesByMonth`, that combines all three robberies-per-month views into one.\nIn creating this view, add a new column called `city`, that identifies the city associated with each row.\nThe final view will have the following columns:\n\n* `city`: The name of the city associated with the row (Use the strings \"Los Angeles\", \"Philadelphia\", and \"Dallas\".)\n* `month`: The month number associated with the row\n* `robbery`: The number of robbery in that month (for that city)\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** You may want to use `UNION` in this example to combine the three datasets.\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** In Databricks, all table schemas are immutable and therefore standard SQL commands such as `ALTER…ADD` and `UPDATE…SET` do not work for adding the new \"city\" column. \n\nInstead, new columns can be added by simply naming them in the `SELECT` statement within the `CREATE OR REPLACE TEMPORARY VIEW` statement.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e2705fff-9238-4277-bd10-0ad42a9ca6e4"},{"version":"CommandV1","origId":1745794912676514,"guid":"80a4161b-3342-49de-aae3-05e21604ddd6","subtype":"command","commandType":"auto","position":43.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"49265a24-606d-4718-b9e7-710f230e62e3"},{"version":"CommandV1","origId":1745794912676515,"guid":"839dd3bf-71fc-4517-a39e-eb8b769d3f7e","subtype":"command","commandType":"auto","position":44.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nresults = [ (r.city, r.month, r.robberies) for r in spark.sql(\"SELECT * FROM CombinedRobberiesByMonth\").collect() ]\n\ndbTest(\"SQL-L7-combinedRobberiesByMonth-counts-0\", (u'Los Angeles', 12, 853), results[0])\ndbTest(\"SQL-L7-combinedRobberiesByMonth-counts-10\", (u'Los Angeles', 11, 764), results[10])\ndbTest(\"SQL-L7-combinedRobberiesByMonth-counts-20\", (u'Philadelphia', 7, 537), results[20])\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"143d302d-ae44-419c-9aab-f03155687ee0"},{"version":"CommandV1","origId":1745794912676516,"guid":"c06d8d88-cae2-4c94-a550-98f7a7267f11","subtype":"command","commandType":"auto","position":45.0,"command":"%md-sandbox\n## Step 6\n\nGraph the contents of `CombinedRobberiesByMonth`, producing a graph similar to the following. (The diagram below deliberately\nuses different data.)\n\n<img src=\"https://files.training.databricks.com/images/eLearning/combined-homicides.png\" style=\"width: 800px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n\nAdjust the plot options to configure the plot properly, as shown below:\n\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-4.png\" style=\"width: 362px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** Order your results by `month`, then `city`.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fb785e74-e5b7-4541-aae6-17b8b3f573fb"},{"version":"CommandV1","origId":1745794912676517,"guid":"d5bd7e7d-8992-44fa-9cee-37a29f9b6252","subtype":"command","commandType":"auto","position":46.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5b32e0c0-d947-409d-8157-b8713bc0b248"},{"version":"CommandV1","origId":1745794912676518,"guid":"6fdc34f0-6257-42e4-ad54-62d1b56f86a0","subtype":"command","commandType":"auto","position":47.0,"command":"%md\n## Step 7\n\nWhile the above graph is interesting, it's flawed: it's comparing the raw numbers of robberies, not the per capita robbery rates.\n\nThe table (already created) called `CityData`  contains, among other data, estimated 2016 population values for all United States cities\nwith populations of at least 100,000. (The data is from [Wikipedia](https://en.wikipedia.org/wiki/List_of_United_States_cities_by_population).)\n\n* Use the population values in that table to normalize the robberies so they represent per-capita values (i.e. total robberies divided by population)\n* Save your results in a temporary view called `RobberyRatesByCity`\n* The robbery rate value must be stored in a new column, `robberyRate`\n\nNext, graph the results, as above.","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0a6a2b2c-82c8-4a41-80dc-080f41ecb1c7"},{"version":"CommandV1","origId":1745794912676519,"guid":"81424e5b-00bf-4a2a-98e0-155619960fa1","subtype":"command","commandType":"auto","position":48.0,"command":"%sql\n-- TODO\n\n<<FILL_IN>>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"718a53b4-280d-4a2d-8c98-f85c79a78157"},{"version":"CommandV1","origId":1745794912676520,"guid":"575f88d7-15c2-406e-a15c-95cde32b9e66","subtype":"command","commandType":"auto","position":49.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nresults = [ (r.city, r.month, \"{0:0.6f}\".format(r.robberyRate)) for r in spark.sql(\"SELECT * FROM RobberyRatesByCity\").collect() ]\n\ndbTest(\"SQL-L7-roberryRatesByCity-counts-0\", (u'Los Angeles', 12, '0.000215'), results[0])\ndbTest(\"SQL-L7-roberryRatesByCity-counts-10\", (u'Los Angeles', 11, '0.000192'), results[10])\ndbTest(\"SQL-L7-roberryRatesByCity-counts-20\", (u'Philadelphia', 7, '0.000343'), results[20])\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a75201f7-8af6-40cf-a7cf-f371d910fa4c"},{"version":"CommandV1","origId":1745794912676521,"guid":"f37979f7-024a-42f6-94e8-ce4c81415ed8","subtype":"command","commandType":"auto","position":51.0,"command":"%md\n## References\n\nThe crime data used in this notebook comes from the following locations:\n\n| City          | Original Data \n| ------------- | -------------\n| Boston        | <a href=\"https://data.boston.gov/group/public-safety\" target=\"_blank\">https&#58;//data.boston.gov/group/public-safety</a>\n| Chicago       | <a href=\"https://data.cityofchicago.org/Public-Safety/Crimes-2001-to-present/ijzp-q8t2\" target=\"_blank\">https&#58;//data.cityofchicago.org/Public-Safety/Crimes-2001-to-present/ijzp-q8t2</a>\n| Dallas        | <a href=\"https://www.dallasopendata.com/Public-Safety/Police-Incidents/tbnj-w5hb/data\" target=\"_blank\">https&#58;//www.dallasopendata.com/Public-Safety/Police-Incidents/tbnj-w5hb/data</a>\n| Los Angeles   | <a href=\"https://data.lacity.org/A-Safe-City/Crime-Data-From-2010-to-Present/y8tr-7khq\" target=\"_blank\">https&#58;//data.lacity.org/A-Safe-City/Crime-Data-From-2010-to-Present/y8tr-7khq</a>\n| New Orleans   | <a href=\"https://data.nola.gov/Public-Safety-and-Preparedness/Electronic-Police-Report-2016/4gc2-25he/data\" target=\"_blank\">https&#58;//data.nola.gov/Public-Safety-and-Preparedness/Electronic-Police-Report-2016/4gc2-25he/data</a>\n| New York      | <a href=\"https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Historic/qgea-i56i\" target=\"_blank\">https&#58;//data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Historic/qgea-i56i</a>\n| Philadelphia  | <a href=\"https://www.opendataphilly.org/dataset/crime-incidents\" target=\"_blank\">https&#58;//www.opendataphilly.org/dataset/crime-incidents</a>","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fa88191b-188c-4682-9cfc-8fe32374d42c"}],"dashboards":[],"guid":"990d52b2-0e1b-4189-a0f0-2340c2d900a9","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}