{"version":"NotebookV1","origId":1745794912675835,"name":"Exploratory-Data-Analysis","language":"python","commands":[{"version":"CommandV1","origId":1745794912675836,"guid":"eeebdd50-98b5-40cb-9858-abe42d62cdaf","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Project: Exploratory Data Analysis\nPerform exploratory data analysis (EDA) to gain insights from a data lake.\n\n## Instructions\n\nIn `dbfs:/mnt/training/crime-data-2016`, there are a number of Parquet files containing 2016 crime data from seven United States cities:\n\n* New York\n* Los Angeles\n* Chicago\n* Philadelphia\n* Dallas\n* Boston\n\nThe data is cleaned up a little, but has not been normalized. Each city reports crime data slightly differently, so\nexamine the data for each city to determine how to query it properly.\n\nYour job is to use some of this data to gain insights about certain kinds of crimes.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"90ef1431-5a57-4092-a395-169a24e65d96"},{"version":"CommandV1","origId":1745794912675837,"guid":"e2d74702-9ad0-44a4-942f-6e7f02b5a85c","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n### Getting Started\n\nRun the following cell to configure our \"classroom.\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"28d54ef1-0d88-4b4b-88bd-2bdd7342270f"},{"version":"CommandV1","origId":1745794912675838,"guid":"f0b2222b-90d6-4dc4-8eb0-90684f71dd28","subtype":"command","commandType":"auto","position":4.0,"command":"%run ../Includes/Classroom-Setup","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c039ded8-6b87-4301-86f5-4d0770fdb354"},{"version":"CommandV1","origId":1745794912675839,"guid":"5ff3c346-c93b-47a8-a586-56aa7c995275","subtype":"command","commandType":"auto","position":5.0,"command":"%md-sandbox\n## Step 1\n\nStart by creating temporary views for Los Angeles, Philadelphia, and Dallas\n\nUse `CREATE TEMPORARY VIEW` to create named views for the files you choose. Use a similar syntax as `CREATE TABLE`:\n\n```\nCREATE OR REPLACE TEMPORARY VIEW name\n  USING parquet\n  OPTIONS (\n    ...\n  )\n```\n\nUse the following view names:\n\n| City          | Table Name              | Path to DBFS file\n| ------------- | ----------------------- | -----------------\n| Los Angeles   | `CrimeDataLosAngeles`   | `dbfs:/mnt/training/crime-data-2016/Crime-Data-Los-Angeles-2016.parquet`\n| Philadelphia  | `CrimeDataPhiladelphia` | `dbfs:/mnt/training/crime-data-2016/Crime-Data-Philadelphia-2016.parquet`\n| Dallas        | `CrimeDataDallas`       | `dbfs:/mnt/training/crime-data-2016/Crime-Data-Dallas-2016.parquet`\n\n\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** You learned how to create a table from an external file in [Lesson 3]($./03-Accessing-Data). The syntax is exactly the same, except that you use `CREATE OR REPLACE TEMPORARY VIEW` instead of `CREATE TABLE IF EXISTS`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dd0a6a4a-bf1f-4b21-b4f1-84049024d2c2"},{"version":"CommandV1","origId":1745794912675840,"guid":"9afa436f-53e3-44bf-afc7-1db8b9159c3c","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"12dbd26d-9261-4332-9b47-7e16fabe9624"},{"version":"CommandV1","origId":1745794912675841,"guid":"d4a51065-7246-45f7-88bb-8c2c05f2a017","subtype":"command","commandType":"auto","position":7.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW CrimeDataLosAngeles\n  USING parquet\n  OPTIONS (\n    path \"dbfs:/mnt/training/crime-data-2016/Crime-Data-Los-Angeles-2016.parquet\"\n  )","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"30330a8e-e38b-4d85-a196-532d34a50163"},{"version":"CommandV1","origId":1745794912675842,"guid":"b534b873-8b85-4d63-a6d2-691bc5fbc833","subtype":"command","commandType":"auto","position":8.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nrowsLosAngeles = spark.sql('SELECT count(*) FROM CrimeDataLosAngeles').collect()[0][0]\ndbTest(\"SQL-L7-crimeDataLA-count\", 217945, rowsLosAngeles)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f1b6091a-0291-4cf4-9000-1226512c10a1"},{"version":"CommandV1","origId":1745794912675843,"guid":"86f3724c-2c08-446e-9498-ec7d08fb7675","subtype":"command","commandType":"auto","position":9.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2897596d-1bdb-490e-b018-acd05d68aac6"},{"version":"CommandV1","origId":1745794912675844,"guid":"52ce44f4-8162-4bd1-837c-02d6a5097a07","subtype":"command","commandType":"auto","position":10.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW CrimeDataPhiladelphia\nUSING parquet\nOPTIONS (\n  path \"dbfs:/mnt/training/crime-data-2016/Crime-Data-Philadelphia-2016.parquet\"\n)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"396abcc5-a026-478c-b653-36cc7c2323bd"},{"version":"CommandV1","origId":1745794912675845,"guid":"b3d63e5e-c4d3-45d1-97a7-80532154c75f","subtype":"command","commandType":"auto","position":11.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nrowsPhiladelphia = spark.sql('SELECT count(*) FROM CrimeDataPhiladelphia').collect()[0][0]\ndbTest(\"SQL-L7-crimeDataPA-count\", 168664, rowsPhiladelphia)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8330cf74-06eb-438f-9065-b0f690691ea6"},{"version":"CommandV1","origId":1745794912675846,"guid":"48587a72-ab49-4687-8c58-089ea25462f6","subtype":"command","commandType":"auto","position":12.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b7d477ed-1abe-4da8-be95-9ba809a7db91"},{"version":"CommandV1","origId":1745794912675847,"guid":"a10dd3e0-4a21-46dc-af75-8e5d76a5656a","subtype":"command","commandType":"auto","position":13.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW CrimeDataDallas\nUSING parquet\nOPTIONS (\n  path \"dbfs:/mnt/training/crime-data-2016/Crime-Data-Dallas-2016.parquet\"\n)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7ddf2cc9-37e4-4487-a26b-2e95912824f6"},{"version":"CommandV1","origId":1745794912675848,"guid":"59a6a97c-ba41-4a89-990c-87cdbe8dde53","subtype":"command","commandType":"auto","position":14.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nrowsDallas = spark.sql('SELECT count(*) FROM CrimeDataDallas').collect()[0][0]\ndbTest(\"SQL-L7-crimeDataDAL-count\", 99642, rowsDallas) \n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c480b0e1-02d6-4614-9028-8a8c0664e922"},{"version":"CommandV1","origId":1745794912675849,"guid":"b6157068-73b7-4af2-80dc-116c900a079a","subtype":"command","commandType":"auto","position":15.0,"command":"%md-sandbox\n## Step 2\n\nFor each table, examine the data to figure out how to extract _robbery_ statistics.\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> Each city uses different values to indicate robbery. Some cities use \"larceny\", \"burglary\", and \"robbery\".  These challenges are common in data lakes.  Restrict yourself to only robberies.\n\nExplore the data for the three cities until you understand how each city records robbery information. If you don't want to worry about upper- or lower-case, remember that SQL has a `LOWER()` function that converts a column's value to lowercase.\n\nCreate a temporary view containing only the robbery-related rows, as shown in the table below.\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** For each table, focus your efforts on the column listed below.\n\nFocus on the following columns for each table:\n\n| Table Name              | Robbery View Name     | Column\n| ----------------------- | ----------------------- | -------------------------------\n| `CrimeDataLosAngeles`   | `RobberyLosAngeles`   | `crimeCodeDescription`\n| `CrimeDataPhiladelphia` | `RobberyPhiladelphia` | `ucr_general_description`\n| `CrimeDataDallas`       | `RobberyDallas`       | `typeOfIncident`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a400f4a0-cfba-4f80-ad1c-1126a29ce96b"},{"version":"CommandV1","origId":1745794912675850,"guid":"dcbacc8c-08c0-416f-b1b2-1d9fe8514e9a","subtype":"command","commandType":"auto","position":16.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6af8ed65-c949-43e2-b41a-f116fd82b3be"},{"version":"CommandV1","origId":1745794912675851,"guid":"863dd169-a714-40e6-828c-09acb2a036ca","subtype":"command","commandType":"auto","position":17.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW RobberyLosAngeles AS\n  SELECT * \n  FROM CrimeDataLosAngeles\n  WHERE lower(crimeCodeDescription) = 'robbery'","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a297c129-de50-46c3-a1d9-898e91bf37f4"},{"version":"CommandV1","origId":1745794912675852,"guid":"2dcc494f-ac8e-4783-95b4-3f7231c2d0c4","subtype":"command","commandType":"auto","position":18.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\ntotalLosAngeles = spark.sql(\"SELECT count(*) AS total FROM RobberyLosAngeles\").collect()[0].total\ndbTest(\"SQL-L7-robberyDataLA-count\", 9048, totalLosAngeles)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6fe71073-27a8-462b-bdb2-fce5f44bb692"},{"version":"CommandV1","origId":1745794912675853,"guid":"aba452bd-f234-4271-9a62-1499a6e54ecc","subtype":"command","commandType":"auto","position":19.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c2fbc582-e25b-44ca-a210-3a0fe6ff5f76"},{"version":"CommandV1","origId":1745794912675854,"guid":"187063eb-dd8f-4c13-a600-16a6985cfe5d","subtype":"command","commandType":"auto","position":20.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW RobberyPhiladelphia AS\n  SELECT * \n  FROM CrimeDataPhiladelphia\n  WHERE lower(ucr_general_description) = 'robbery'","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"36a4ac7d-632b-4337-83c5-e0934090d594"},{"version":"CommandV1","origId":1745794912675855,"guid":"4a42fdf8-0d67-41b4-b86f-5c16e025ca0f","subtype":"command","commandType":"auto","position":21.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\ntotalPhiladelphia = spark.sql(\"SELECT count(*) AS total FROM RobberyPhiladelphia\").collect()[0].total\ndbTest(\"SQL-L7-robberyDataPA-count\", 6149, totalPhiladelphia)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a3bfa645-607b-4ba8-819c-9c9780abacdb"},{"version":"CommandV1","origId":1745794912675856,"guid":"fd89694b-9ed3-44a3-b934-90658fd7ae4b","subtype":"command","commandType":"auto","position":22.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8d08596c-fe02-4c78-8b07-5bd9a6199d62"},{"version":"CommandV1","origId":1745794912675857,"guid":"d0d6e00c-2baf-4b87-bc7c-45b6e12caffb","subtype":"command","commandType":"auto","position":23.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW RobberyDallas AS\n  SELECT * \n  FROM CrimeDataDallas\n  WHERE lower(typeOfIncident) LIKE 'robbery%'","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7c5db9cb-bd54-493e-b9d8-a5bae0b6b8f1"},{"version":"CommandV1","origId":1745794912675858,"guid":"d8dfe085-ce4b-484d-9b02-4540e82c1c97","subtype":"command","commandType":"auto","position":24.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\ntotalDallas = spark.sql(\"SELECT count(*) AS total FROM RobberyDallas\").collect()[0].total\ndbTest(\"SQL-L7-robberyDataDAL-count\", 6824, totalDallas)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7af0838f-540b-4d76-bbc2-ebfcec1b2ecb"},{"version":"CommandV1","origId":1745794912675859,"guid":"9a1fc71d-ad18-4059-8b39-119cec95e0c9","subtype":"command","commandType":"auto","position":25.0,"command":"%md-sandbox\n## Step 3\n\nNow that you have views of only the robberies in each city, create temporary views for each city, summarizing the number of robberies in each month.\n\nYour views must contain two columns:\n* `month`: The month number (e.g., 1 for January, 2 for February, etc.)\n* `robberies`: The total number of robberies in the month\n\nUse the following temporary view names and date columns:\n\n\n| City          | View Name     | Date Column \n| ------------- | ------------- | -------------\n| Los Angeles   | `RobberiesByMonthLosAngeles` | `timeOccurred`\n| Philadelphia  | `RobberiesByMonthPhiladelphia` | `dispatch_date_time`\n| Dallas        | `RobberiesByMonthDallas` | `startingDateTime`\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> For each city, figure out which column contains the date of the incident. Then, extract the month from that date.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d4e7229d-5104-4d0a-947e-59507f1d7b65"},{"version":"CommandV1","origId":1745794912675860,"guid":"a7d3565d-d713-44fa-905f-19e0defbb4d1","subtype":"command","commandType":"auto","position":26.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"26bd25f9-ae0c-4d00-9834-7dce9409a070"},{"version":"CommandV1","origId":1745794912675861,"guid":"7942937f-7bb8-49c1-8101-76b670b82ba4","subtype":"command","commandType":"auto","position":27.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW RobberiesByMonthLosAngeles AS\n  SELECT month(timeOccurred) AS month, count(*) AS robberies\n  FROM RobberyLosAngeles\n  GROUP BY month(timeOccurred)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"923762b9-a624-40d8-b113-c5594f54158f"},{"version":"CommandV1","origId":1745794912675862,"guid":"06beb945-e68b-4cfd-b91c-11be9b3b624d","subtype":"command","commandType":"auto","position":28.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nla = { r.month : r.robberies for r in spark.sql(\"SELECT * FROM RobberiesByMonthLosAngeles\").collect() }\ndbTest(\"SQL-L7-robberyByMonthLA-counts\", {1: 719, 2: 675, 3: 709, 4: 713, 5: 790, 6: 698, 7: 826, 8: 765, 9: 722, 10: 814, 11: 764, 12: 853}, la)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"482b0d69-50ee-4061-a352-49936cade30a"},{"version":"CommandV1","origId":1745794912675863,"guid":"12a795c6-5799-41a0-a508-97afba4013aa","subtype":"command","commandType":"auto","position":29.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3cba65f3-7b91-4be2-b4a5-9b9a1cc3c7f3"},{"version":"CommandV1","origId":1745794912675864,"guid":"f4dd4b33-2247-413a-a945-6397e70f6014","subtype":"command","commandType":"auto","position":30.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW RobberiesByMonthPhiladelphia AS\n  SELECT month(dispatch_date_time) AS month, count(*) as robberies\n  FROM RobberyPhiladelphia\n  GROUP BY month(dispatch_date_time)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5fbd466f-5a07-4214-a1e9-2420f62d0d7d"},{"version":"CommandV1","origId":1745794912675865,"guid":"b62694c2-cbb9-4654-9353-4d1078969fc5","subtype":"command","commandType":"auto","position":31.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nphiladelphia = { r.month : r.robberies for r in spark.sql(\"SELECT * FROM RobberiesByMonthPhiladelphia\").collect() }\ndbTest(\"SQL-L7-robberyByMonthPA-counts\", {1: 520, 2: 416, 3: 432, 4: 466, 5: 533, 6: 509, 7: 537, 8: 561, 9: 514, 10: 572, 11: 545, 12: 544}, philadelphia)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3a313497-2a6a-4fb4-8756-0e69526458a9"},{"version":"CommandV1","origId":1745794912675866,"guid":"54b52df2-f7d2-4bd9-86ff-48e5ab4a2eef","subtype":"command","commandType":"auto","position":32.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2c303f38-5a34-4c34-a91f-fd7de4a7838f"},{"version":"CommandV1","origId":1745794912675867,"guid":"b693a3bb-d1ee-440b-938d-1c543e3154ed","subtype":"command","commandType":"auto","position":33.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW RobberiesByMonthDallas AS\n  SELECT month(startingDateTime) AS month, count(*) as robberies\n  FROM RobberyDallas\n  GROUP BY month(startingDateTime)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f3354a01-eddd-4fb0-8964-f0f6b807fa91"},{"version":"CommandV1","origId":1745794912675868,"guid":"e53c9498-12f5-4810-9864-140e0811bc49","subtype":"command","commandType":"auto","position":34.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\ndallas = { r.month : r.robberies for r in spark.sql(\"SELECT * FROM RobberiesByMonthDallas\").collect() }\ndbTest(\"SQL-L7-robberyByMonthDAL-counts\", {1: 743, 2: 435, 3: 412, 4: 594, 5: 615, 6: 495, 7: 535, 8: 627, 9: 512, 10: 603, 11: 589, 12: 664}, dallas)\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d4279156-df87-473b-bea3-9770ec1381ff"},{"version":"CommandV1","origId":1745794912675869,"guid":"6b198dd2-3766-477a-afda-485badcbb6ba","subtype":"command","commandType":"auto","position":35.0,"command":"%md-sandbox\n\n## Step 4\n\nPlot the robberies per month for each of your three cities, producing a plot similar to the following:\n\n<img src=\"https://files.training.databricks.com/images/eLearning/robberies-by-month.png\" style=\"max-width: 700px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n\nWhen you first run your cell, you'll get an HTML table as the result. To configure the plot,\n\n1. Click the graph button\n2. If the plot doesn't look correct, click the **Plot Options** button\n3. Configure the plot similar to the following example\n\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-1.png\" style=\"width: 440px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-2.png\" style=\"width: 268px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-3.png\" style=\"width: 362px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"40407b82-89e7-4893-9087-a8d76357ca04"},{"version":"CommandV1","origId":1745794912675870,"guid":"2c2d1e34-d3bc-42cb-a952-d6f4e2e24a9c","subtype":"command","commandType":"auto","position":36.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"15da54f2-4f6a-4793-8839-70ff28126a75"},{"version":"CommandV1","origId":1745794912675871,"guid":"94dbcd07-d081-46fb-8afb-74a25434513d","subtype":"command","commandType":"auto","position":37.0,"command":"%sql\n-- ANSWER\n\nSELECT * FROM RobberiesByMonthLosAngeles ORDER BY month","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"614c0387-c688-436b-935c-22e68e528cfa"},{"version":"CommandV1","origId":1745794912675872,"guid":"1d75e1b4-6515-41b6-a3f4-32706c1a2b9e","subtype":"command","commandType":"auto","position":38.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5b0144fa-d995-4bcf-ab08-b48fbf2c4420"},{"version":"CommandV1","origId":1745794912675873,"guid":"96db6a35-023f-45e9-85f5-955cac33a9e3","subtype":"command","commandType":"auto","position":39.0,"command":"%sql\n-- ANSWER\n\nSELECT * FROM RobberiesByMonthPhiladelphia ORDER BY month","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cde9e1a7-efa4-42ae-9b86-df27fa48a4c9"},{"version":"CommandV1","origId":1745794912675874,"guid":"31aac3e5-ae8c-438e-a220-c8d98bfb6b94","subtype":"command","commandType":"auto","position":40.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"16279199-c133-4117-8ed7-7cf51cd5e970"},{"version":"CommandV1","origId":1745794912675875,"guid":"3896758b-1aac-4558-9efe-c6f6a1f90bf2","subtype":"command","commandType":"auto","position":41.0,"command":"%sql\n-- ANSWER\n\nSELECT * FROM RobberiesByMonthDallas ORDER BY month","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"edc65b01-c53b-4a4b-b9fd-db8e4cbe96e7"},{"version":"CommandV1","origId":1745794912675876,"guid":"9e87dd28-a776-421a-a526-18a225feb883","subtype":"command","commandType":"auto","position":42.0,"command":"%md-sandbox\n## Step 5\n\nCreate another temporary view called `CombinedRobberiesByMonth`, that combines all three robberies-per-month views into one.\nIn creating this view, add a new column called `city`, that identifies the city associated with each row.\nThe final view will have the following columns:\n\n* `city`: The name of the city associated with the row (Use the strings \"Los Angeles\", \"Philadelphia\", and \"Dallas\".)\n* `month`: The month number associated with the row\n* `robbery`: The number of robbery in that month (for that city)\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** You may want to use `UNION` in this example to combine the three datasets.\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** In Databricks, all table schemas are immutable and therefore standard SQL commands such as `ALTER…ADD` and `UPDATE…SET` do not work for adding the new \"city\" column. \n\nInstead, new columns can be added by simply naming them in the `SELECT` statement within the `CREATE OR REPLACE TEMPORARY VIEW` statement.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ad826c3b-3d1c-4ff8-b233-eece5b0d8294"},{"version":"CommandV1","origId":1745794912675877,"guid":"e85fc7a2-6565-4ec1-831c-42befcc7bfdc","subtype":"command","commandType":"auto","position":43.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW CombinedRobberiesByMonth AS\n  SELECT 'Los Angeles' AS city, * FROM RobberiesByMonthLosAngeles\n    UNION ALL\n  SELECT 'Philadelphia' AS city, * FROM RobberiesByMonthPhiladelphia\n    UNION ALL\n  SELECT 'Dallas' AS city, * FROM RobberiesByMonthDallas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"849cd274-be2d-4c44-b47c-8643c3516a3d"},{"version":"CommandV1","origId":1745794912675878,"guid":"5e4a8865-6503-4cae-9d95-d52e6d8a7aa0","subtype":"command","commandType":"auto","position":44.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nresults = [ (r.city, r.month, r.robberies) for r in spark.sql(\"SELECT * FROM CombinedRobberiesByMonth\").collect() ]\n\ndbTest(\"SQL-L7-combinedRobberiesByMonth-counts-0\", (u'Los Angeles', 12, 853), results[0])\ndbTest(\"SQL-L7-combinedRobberiesByMonth-counts-10\", (u'Los Angeles', 11, 764), results[10])\ndbTest(\"SQL-L7-combinedRobberiesByMonth-counts-20\", (u'Philadelphia', 7, 537), results[20])\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"792791fc-fce1-4d8f-98d8-c83efde081af"},{"version":"CommandV1","origId":1745794912675879,"guid":"1781d31b-4256-472c-b709-0c9db51436ca","subtype":"command","commandType":"auto","position":45.0,"command":"%md-sandbox\n## Step 6\n\nGraph the contents of `CombinedRobberiesByMonth`, producing a graph similar to the following. (The diagram below deliberately\nuses different data.)\n\n<img src=\"https://files.training.databricks.com/images/eLearning/combined-homicides.png\" style=\"width: 800px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n\nAdjust the plot options to configure the plot properly, as shown below:\n\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-4.png\" style=\"width: 362px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** Order your results by `month`, then `city`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"524ff3a7-11d6-4d75-9806-a086c1d5cf27"},{"version":"CommandV1","origId":1745794912675880,"guid":"94f99ae2-bc5b-452f-bb7e-6220b55c3fd9","subtype":"command","commandType":"auto","position":46.0,"command":"%sql\n-- ANSWER\n\nSELECT * FROM CombinedRobberiesByMonth ORDER BY month, city","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1e3b5172-796d-4e87-b990-e5025a5650fb"},{"version":"CommandV1","origId":1745794912675881,"guid":"65f0f228-a2c9-46d9-b30c-565af69e52b3","subtype":"command","commandType":"auto","position":47.0,"command":"%md\n## Step 7\n\nWhile the above graph is interesting, it's flawed: it's comparing the raw numbers of robberies, not the per capita robbery rates.\n\nThe table (already created) called `CityData`  contains, among other data, estimated 2016 population values for all United States cities\nwith populations of at least 100,000. (The data is from [Wikipedia](https://en.wikipedia.org/wiki/List_of_United_States_cities_by_population).)\n\n* Use the population values in that table to normalize the robberies so they represent per-capita values (i.e. total robberies divided by population)\n* Save your results in a temporary view called `RobberyRatesByCity`\n* The robbery rate value must be stored in a new column, `robberyRate`\n\nNext, graph the results, as above.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fa1c3c5c-1a79-47b0-9df1-cf36603711cb"},{"version":"CommandV1","origId":1745794912675882,"guid":"71775529-1649-49bb-8066-9708adbf6e60","subtype":"command","commandType":"auto","position":48.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW RobberyRatesByCity AS\n  SELECT CombinedRobberiesByMonth.city, month, (robberies / estPopulation2016) AS robberyRate\n  FROM CombinedRobberiesByMonth\n    INNER JOIN CityData\n    ON CityData.city = CombinedRobberiesByMonth.City","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c29890e4-0c04-4709-bcd3-d57f7d839078"},{"version":"CommandV1","origId":1745794912675883,"guid":"748e1f14-fb1b-47bd-a3ec-b1037bd4e554","subtype":"command","commandType":"auto","position":49.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nresults = [ (r.city, r.month, \"{0:0.6f}\".format(r.robberyRate)) for r in spark.sql(\"SELECT * FROM RobberyRatesByCity\").collect() ]\n\ndbTest(\"SQL-L7-roberryRatesByCity-counts-0\", (u'Los Angeles', 12, '0.000215'), results[0])\ndbTest(\"SQL-L7-roberryRatesByCity-counts-10\", (u'Los Angeles', 11, '0.000192'), results[10])\ndbTest(\"SQL-L7-roberryRatesByCity-counts-20\", (u'Philadelphia', 7, '0.000343'), results[20])\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f3dfa9b3-d9a0-49f4-ba61-0d735ef35a3c"},{"version":"CommandV1","origId":1745794912675884,"guid":"12913e99-1d30-4f9b-b858-550fa319a0d8","subtype":"command","commandType":"auto","position":51.0,"command":"%md\n## References\n\nThe crime data used in this notebook comes from the following locations:\n\n| City          | Original Data \n| ------------- | -------------\n| Boston        | <a href=\"https://data.boston.gov/group/public-safety\" target=\"_blank\">https&#58;//data.boston.gov/group/public-safety</a>\n| Chicago       | <a href=\"https://data.cityofchicago.org/Public-Safety/Crimes-2001-to-present/ijzp-q8t2\" target=\"_blank\">https&#58;//data.cityofchicago.org/Public-Safety/Crimes-2001-to-present/ijzp-q8t2</a>\n| Dallas        | <a href=\"https://www.dallasopendata.com/Public-Safety/Police-Incidents/tbnj-w5hb/data\" target=\"_blank\">https&#58;//www.dallasopendata.com/Public-Safety/Police-Incidents/tbnj-w5hb/data</a>\n| Los Angeles   | <a href=\"https://data.lacity.org/A-Safe-City/Crime-Data-From-2010-to-Present/y8tr-7khq\" target=\"_blank\">https&#58;//data.lacity.org/A-Safe-City/Crime-Data-From-2010-to-Present/y8tr-7khq</a>\n| New Orleans   | <a href=\"https://data.nola.gov/Public-Safety-and-Preparedness/Electronic-Police-Report-2016/4gc2-25he/data\" target=\"_blank\">https&#58;//data.nola.gov/Public-Safety-and-Preparedness/Electronic-Police-Report-2016/4gc2-25he/data</a>\n| New York      | <a href=\"https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Historic/qgea-i56i\" target=\"_blank\">https&#58;//data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Historic/qgea-i56i</a>\n| Philadelphia  | <a href=\"https://www.opendataphilly.org/dataset/crime-incidents\" target=\"_blank\">https&#58;//www.opendataphilly.org/dataset/crime-incidents</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8183462a-11a8-4ac3-ae16-0eba85e75a16"}],"dashboards":[],"guid":"7471f592-5a8d-44be-8e32-0004329396eb","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}