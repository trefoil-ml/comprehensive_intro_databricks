{"version":"NotebookV1","origId":1745794912674952,"name":"05-Querying-JSON","language":"scala","commands":[{"version":"CommandV1","origId":1745794912674953,"guid":"3333e8fe-62da-4b49-a99e-2836e9706c83","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Querying JSON & Hierarchical Data with DataFrames\n\nApache Spark&trade; and Azure Databricks&reg; make it easy to work with hierarchical data, such as nested JSON records.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5a99bd64-87d4-478f-88c0-197440626573"},{"version":"CommandV1","origId":1745794912674954,"guid":"d5eae6d5-41fb-4479-a796-9f4c5e91c2e2","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n### Getting Started\n\nRun the following cell to configure our \"classroom.\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"463ce47e-0900-4c3f-bd96-1075a47f9261"},{"version":"CommandV1","origId":1745794912674955,"guid":"3ce4278d-0c7d-4bf6-9735-88be7aeb6c00","subtype":"command","commandType":"auto","position":4.0,"command":"%run \"./Includes/Classroom-Setup\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dec52813-01d4-43d5-8402-285b874da19e"},{"version":"CommandV1","origId":1745794912674956,"guid":"1b9126e6-71ef-470f-ac31-eb04e6d724fd","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n## Examining the Contents of a JSON file\n\nJSON is a common file format used in big data applications and in data lakes (or large stores of diverse data).  File formats such as JSON arise out of a number of data needs.  For instance, what if:\n<br>\n* Your schema, or the structure of your data, changes over time?\n* You need nested fields like an array with many values or an array of arrays?\n* You don't know how you're going use your data yet, so you don't want to spend time creating relational tables?\n\nThe popularity of JSON is largely due to the fact that JSON allows for nested, flexible schemas.\n\nThis lesson uses the `DatabricksBlog` table, which is backed by JSON file `dbfs:/mnt/training/databricks-blog.json`. If you examine the raw file, notice it contains compact JSON data. There's a single JSON object on each line of the file; each object corresponds to a row in the table. Each row represents a blog post on the <a href=\"https://databricks.com/blog\" target=\"_blank\">Databricks blog</a>, and the table contains all blog posts through August 9, 2017.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ecb837dc-81a2-470c-9a73-848745e4d23a"},{"version":"CommandV1","origId":1745794912674957,"guid":"fbfe1c96-dae6-4ee2-a5d1-92a85f201f51","subtype":"command","commandType":"auto","position":8.0,"command":"%fs head dbfs:/mnt/training/databricks-blog.json","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fdcab575-1afc-4d2c-9af0-6fe3e9da4c90"},{"version":"CommandV1","origId":1745794912674958,"guid":"5a041f11-140e-4358-ba80-52aa7398a9f5","subtype":"command","commandType":"auto","position":9.0,"command":"%md\nCreate a DataFrame out of the syntax introduced in the previous lesson:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b87225ba-6cee-4b0d-8366-071045f69e96"},{"version":"CommandV1","origId":1745794912674959,"guid":"e68fba52-3cfd-44c1-9474-97be33c709ca","subtype":"command","commandType":"auto","position":10.0,"command":"val databricksBlogDF = spark.read.option(\"inferSchema\",\"true\").option(\"header\",\"true\").json(\"/mnt/training/databricks-blog.json\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"442a5028-6489-4533-b0b9-66e2ccd8f00c"},{"version":"CommandV1","origId":1745794912674960,"guid":"e0b54fa2-4512-410d-8c3d-ec6b699ea455","subtype":"command","commandType":"auto","position":11.0,"command":"%md\nTake a look at the schema by invoking `printSchema` method.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a4dc8b9b-7aac-4bea-8ae0-7172196613dd"},{"version":"CommandV1","origId":1745794912674961,"guid":"486188a3-23b3-4c37-a0cf-fab8c8adf95c","subtype":"command","commandType":"auto","position":12.0,"command":"databricksBlogDF.printSchema","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f2ad6612-8ae2-4399-9f91-1566aca3e0d1"},{"version":"CommandV1","origId":1745794912674962,"guid":"78e2b2e6-2bfa-4659-8560-0676cb537723","subtype":"command","commandType":"auto","position":13.0,"command":"%md\nRun a query to view the contents of the table.\n\nNotice:\n* The `authors` column is an array containing one or more author names.\n* The `categories` column is an array of one or more blog post category names.\n* The `dates` column contains nested fields `createdOn`, `publishedOn` and `tz`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2ce7ccf7-0287-409c-99ba-84115b6c894d"},{"version":"CommandV1","origId":1745794912674963,"guid":"7749eb3f-70b0-498e-b756-2ce5ddae4388","subtype":"command","commandType":"auto","position":14.0,"command":"display(databricksBlogDF.select($\"authors\",$\"categories\",$\"dates\",$\"content\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c0b09603-b890-4e81-8b4b-c19f0f054e6f"},{"version":"CommandV1","origId":1745794912674964,"guid":"fb7d53c0-1064-453c-a7ac-418e1f5e1394","subtype":"command","commandType":"auto","position":15.0,"command":"%md\n## Nested Data\n\nThink of nested data as columns within columns. \n\nFor instance, look at the `dates` column.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"10814fbe-424c-460f-be7f-43febf1333d2"},{"version":"CommandV1","origId":1745794912674965,"guid":"4be27867-ae57-4fed-87e0-754a647c4417","subtype":"command","commandType":"auto","position":17.0,"command":"val datesDF = databricksBlogDF.select($\"dates\")\ndisplay(datesDF)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"38b914ef-653b-4313-afa6-afdcf66f2746"},{"version":"CommandV1","origId":1745794912674966,"guid":"4cf21160-5c93-4b86-b4ea-5fc0e09c39dd","subtype":"command","commandType":"auto","position":18.0,"command":"%md\nPull out a specific subfield with `.` (object) notation.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f1fb9819-e48b-499c-a6c5-67601debee18"},{"version":"CommandV1","origId":1745794912674967,"guid":"7f12f827-63b5-444a-a9eb-c4acb8a1aead","subtype":"command","commandType":"auto","position":19.0,"command":"display(databricksBlogDF.select($\"dates.createdOn\", $\"dates.publishedOn\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f4fa64e4-2070-49c0-9101-1cc820270158"},{"version":"CommandV1","origId":1745794912674968,"guid":"a51e56c5-9ef9-4b6b-9b5a-59b76ca7121b","subtype":"command","commandType":"auto","position":20.0,"command":"%md\nCreate a DataFrame, `databricksBlog2DF` that contains the original columns plus the new `publishedOn` column obtained\nfrom flattening the dates column.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3765e9c3-e555-4ca5-9efd-24476ace561b"},{"version":"CommandV1","origId":1745794912674969,"guid":"389bc8a3-27fd-4cf0-93ca-65be7ce1ad01","subtype":"command","commandType":"auto","position":21.0,"command":"val databricksBlog2DF = databricksBlogDF.withColumn(\"publishedOn\",$\"dates.publishedOn\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3246cd94-8c83-4d54-9947-5b22c6569c91"},{"version":"CommandV1","origId":1745794912674970,"guid":"d9ccd4ac-dcaf-41f2-8299-8cf68c58cbc6","subtype":"command","commandType":"auto","position":22.0,"command":"%md\nWith this temporary view, apply the `printSchema` method to check its schema and confirm the timestamp conversion.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cc17e752-929a-4e75-8f33-f60caac14291"},{"version":"CommandV1","origId":1745794912674971,"guid":"d5b9c6ff-38ba-47c2-87b5-0992a2d33559","subtype":"command","commandType":"auto","position":23.0,"command":"databricksBlog2DF.printSchema","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d09aa288-e480-461f-8e81-36b56d16c7c4"},{"version":"CommandV1","origId":1745794912674972,"guid":"85772af0-b8c6-4766-986a-736cb66c329d","subtype":"command","commandType":"auto","position":24.0,"command":"%md\nBoth `createdOn` and `publishedOn` are stored as strings.\n\nCast those values to SQL timestamps:\n\nIn this case, use a single `select` method to:\n0. Cast `dates.publishedOn` to a `timestamp` data type\n0. \"Flatten\" the `dates.publishedOn` column to just `publishedOn`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"256aba7f-0570-4fba-acc7-0cff5a1b5972"},{"version":"CommandV1","origId":1745794912674973,"guid":"7bdf692a-afcd-402f-b7a2-a57de77bf421","subtype":"command","commandType":"auto","position":25.0,"command":"import org.apache.spark.sql.functions.to_timestamp\ndisplay(databricksBlogDF.select($\"title\",to_timestamp($\"dates.publishedOn\",\"yyyy-MM-dd\") as \"publishedOn\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c78a8f9b-b977-4187-8bc8-3bd66dc25cd1"},{"version":"CommandV1","origId":1745794912674974,"guid":"16bd4c3c-2415-4ec8-aa89-afec9368bf01","subtype":"command","commandType":"auto","position":26.0,"command":"%md\nCreate another DataFrame, `databricksBlog2DF` that contains the original columns plus the new `publishedOn` column obtained\nfrom flattening the dates column.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7a569bd1-9396-4fab-a3b5-a9a642d8af39"},{"version":"CommandV1","origId":1745794912674975,"guid":"6df5c5cf-7d52-4431-a3b7-7b264bb853ef","subtype":"command","commandType":"auto","position":27.0,"command":"val databricksBlog2DF = databricksBlogDF.withColumn(\"publishedOn\", to_timestamp($\"dates.publishedOn\",\"yyyy-MM-dd\")) \ndisplay(databricksBlog2DF)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4196d612-0cba-4ca8-983f-a2f5e6caecfb"},{"version":"CommandV1","origId":1745794912674976,"guid":"22b27b51-f2a8-4c77-9f2c-20f835d4fa5f","subtype":"command","commandType":"auto","position":28.0,"command":"%md\nWith this temporary view, apply the `printSchema` method to check its schema and confirm the timestamp conversion.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9345f63c-4ae6-43b0-a9cc-32fcaa989c12"},{"version":"CommandV1","origId":1745794912674977,"guid":"a7e1befa-253c-4e63-839b-916c7b5c57d1","subtype":"command","commandType":"auto","position":29.0,"command":"databricksBlog2DF.printSchema","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"122f2701-5aee-4540-bc37-6b5b1fe8a31d"},{"version":"CommandV1","origId":1745794912674978,"guid":"90e85e13-8d10-48c3-bfd2-0644c1b74dd9","subtype":"command","commandType":"auto","position":30.0,"command":"%md-sandbox\nSince the dates are represented by a `timestamp` data type, we need to convert to a data type that allows `<` and `>`-type comparison operations in order to query for articles within certain date ranges (such as a list of all articles published in 2013). This is accopmplished by using the `to_date` function in Scala or Python.\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> See the Spark documentation on <a href=\"https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.functions$\" target=\"_blank\">built-in functions</a>, for a long list of date-specific functions.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2f4f910f-5240-42ad-ac13-72336a5eaf52"},{"version":"CommandV1","origId":1745794912674979,"guid":"4d674d0a-93fb-4207-97c4-e76c5e6f1315","subtype":"command","commandType":"auto","position":31.0,"command":"import org.apache.spark.sql.functions.{to_date, year}\nval resultDF = databricksBlog2DF\n  .select($\"title\",to_date($\"publishedOn\",\"MMM dd, yyyy\") as \"date\",$\"link\")\n  .filter(year($\"publishedOn\") === \"2013\")\n  .orderBy($\"publishedOn\")\n\ndisplay(resultDF)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2141cee9-1aca-4e17-96ca-56a1a59b8c54"},{"version":"CommandV1","origId":1745794912674980,"guid":"673c427b-d10c-4dcd-8802-f9703f4c9ca2","subtype":"command","commandType":"auto","position":32.0,"command":"%md\n## Array Data\n\nThe DataFrame also contains array columns. \n\nEasily determine the size of each array using the built-in `size(..)` function with array columns.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c594d133-33c2-40fa-a917-83bfc2c098ba"},{"version":"CommandV1","origId":1745794912674981,"guid":"407f17ba-cdc9-432e-a6e8-e07a2d365086","subtype":"command","commandType":"auto","position":34.0,"command":"import org.apache.spark.sql.functions.size\ndisplay(databricksBlogDF.select(size($\"authors\"),$\"authors\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"59cddc84-03ba-415a-a40e-34627ed7a38a"},{"version":"CommandV1","origId":1745794912674982,"guid":"3c48c065-db6b-4daa-aa31-34382091abea","subtype":"command","commandType":"auto","position":35.0,"command":"%md\nPull the first element from the array `authors` using an array subscript operator.\n\nFor example, in Scala, the 0th element of array `authors` is `authors(0)`\nwhereas, in Python, the 0th element of `authors` is `authors[0]`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"32da1ab1-b980-40c7-b521-426a274d0a4e"},{"version":"CommandV1","origId":1745794912674983,"guid":"a8b526ed-8b98-478a-b6bc-e473865023ff","subtype":"command","commandType":"auto","position":36.0,"command":"display(databricksBlogDF.select($\"authors\"(0) as \"primaryAuthor\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b6edb1e5-8aca-4d7e-aa2a-c9de08a9ab35"},{"version":"CommandV1","origId":1745794912674984,"guid":"0463d6cf-abd5-45d2-8f98-4bcbfe8050c7","subtype":"command","commandType":"auto","position":37.0,"command":"%md\n### Explode\n\nThe `explode` method allows you to split an array column into multiple rows, copying all the other columns into each new row. \n\nFor example, split the column `authors` into the column `author`, with one author per row.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d0ad753e-66b3-4c9d-af35-1f7275d964ee"},{"version":"CommandV1","origId":1745794912674985,"guid":"7f7cbdd8-8651-4e26-9bf8-1198dbb622fd","subtype":"command","commandType":"auto","position":39.0,"command":"import org.apache.spark.sql.functions.explode\ndisplay(databricksBlogDF.select($\"title\",$\"authors\",explode($\"authors\") as \"author\", $\"link\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"680c4c0b-18ac-4b71-97d5-91177b526ffa"},{"version":"CommandV1","origId":1745794912674986,"guid":"ca5053ef-6e79-4883-b1b5-2f2466fc92fb","subtype":"command","commandType":"auto","position":40.0,"command":"%md\nIt's more obvious to restrict the output to articles that have multiple authors, and then sort by the title.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9aba0e60-a4da-4123-81f7-6c0446a33f42"},{"version":"CommandV1","origId":1745794912674987,"guid":"2dfe72d3-81d5-47c7-abda-a688a211b34f","subtype":"command","commandType":"auto","position":41.0,"command":"val databricksBlog2DF = databricksBlogDF\n  .select($\"title\",$\"authors\",explode($\"authors\") as \"author\", $\"link\")\n  .filter(size($\"authors\") > 1)\n  .orderBy($\"title\")\n  \ndisplay(databricksBlogDF)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a2df94a8-2014-4317-be6e-21eb3e63e9eb"},{"version":"CommandV1","origId":1745794912674988,"guid":"94935428-24a4-4b2e-86a0-387896f54318","subtype":"command","commandType":"auto","position":42.0,"command":"%md\n## Exercise 1\n\nIdentify all the articles written or co-written by Michael Armbrust.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4ca86af6-87c2-4ea3-b02e-a0a931ed290f"},{"version":"CommandV1","origId":1745794912674989,"guid":"33df4a42-21b7-4ecf-a621-caa2101c6507","subtype":"command","commandType":"auto","position":43.0,"command":"%md-sandbox\n### Step 1\n\nStarting with the `databricksBlogDF` DataFrame, create a DataFrame called `articlesByMichaelDF` where:\n0. Michael Armbrust is the author.\n0. The data set contains the column `title` (it may contain others).\n0. It contains only one record per article.\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** See the Spark documentation on <a href=\"https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.functions$\" target=\"_blank\">built-in functions</a>.  \n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** Include the column `authors` in your view to help you debug your solution.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5451eb06-15dd-4cbe-a9cd-987d8c49212d"},{"version":"CommandV1","origId":1745794912674990,"guid":"aae96188-523c-4cb2-8913-1c7d38cdc623","subtype":"command","commandType":"auto","position":44.0,"command":"// ANSWER\nimport org.apache.spark.sql.functions.array_contains\nval articlesByMichaelDF = databricksBlogDF.select($\"title\").filter(array_contains($\"authors\", \"Michael Armbrust\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3e15b9be-3474-47c0-a24d-a722f2ac9e4c"},{"version":"CommandV1","origId":1745794912674991,"guid":"e6c50328-e015-4334-a348-65fe87a662c4","subtype":"command","commandType":"auto","position":45.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val resultsCount = articlesByMichaelDF.count()\ndbTest(\"DF-L5-articlesByMichael-count\", 3, resultsCount)  \n\nlazy val results = articlesByMichaelDF.collect()\n\ndbTest(\"DF-L5-articlesByMichael-0\", Row(\"Spark SQL: Manipulating Structured Data Using Apache Spark\"), results(0))\ndbTest(\"DF-L5-articlesByMichael-1\", Row(\"Exciting Performance Improvements on the Horizon for Spark SQL\"), results(1))\ndbTest(\"DF-L5-articlesByMichael-2\", Row(\"Spark SQL Data Sources API: Unified Data Access for the Apache Spark Platform\"), results(2))\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9692edbc-9a71-4fe9-a3e2-d77a841103ce"},{"version":"CommandV1","origId":1745794912674992,"guid":"acbd9125-8e17-4706-b364-be969dca650c","subtype":"command","commandType":"auto","position":46.0,"command":"%md\n### Step 2\nShow the list of Michael Armbrust's articles in HTML format.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6d8b4739-c355-4847-ba18-d09cf1c801d7"},{"version":"CommandV1","origId":1745794912674993,"guid":"13cd2cde-559d-4fbd-bd6c-068a408fa0b3","subtype":"command","commandType":"auto","position":47.0,"command":"// ANSWER\n\ndisplay(articlesByMichaelDF)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f91eeb10-eb7e-4cb5-8a78-86b066c0b75e"},{"version":"CommandV1","origId":1745794912674994,"guid":"67cca5b0-8939-4529-871c-36887920996d","subtype":"command","commandType":"auto","position":48.0,"command":"%md\n## Exercise 2\n\nIdentify the complete set of categories used in the Databricks blog articles.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"eb5e4d0b-f79d-415e-969f-224370b703ee"},{"version":"CommandV1","origId":1745794912674995,"guid":"fd87afcf-91c6-4ecf-9a73-8471ced17f14","subtype":"command","commandType":"auto","position":49.0,"command":"%md\n### Step 1\n\nStarting with the `databricksBlogDF` DataFrame, create another DataFrame called `uniqueCategoriesDF` where:\n0. The data set contains the one column `category` (and no others).\n0. This list of categories should be unique.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1bf259fa-8280-49f3-bf53-d670fc4aa750"},{"version":"CommandV1","origId":1745794912674996,"guid":"99d2a829-aa45-4395-8e0f-6fd063c2a567","subtype":"command","commandType":"auto","position":50.0,"command":"// ANSWER\nval uniqueCategoriesDF = databricksBlogDF.select(explode($\"categories\") as \"category\").orderBy($\"category\").distinct()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c920cd1b-eda5-49f6-a885-c6f44dc9018a"},{"version":"CommandV1","origId":1745794912674997,"guid":"add0c3d0-cbc4-4d35-9f10-5f993eeebab9","subtype":"command","commandType":"auto","position":51.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val resultsCount =  uniqueCategoriesDF.count()\n\ndbTest(\"DF-L5-uniqueCategories-count\", 12, resultsCount)\n\nlazy val results = uniqueCategoriesDF.collect()\ndbTest(\"DF-L5-uniqueCategories-0\", Row(\"Announcements\"), results(0) )\ndbTest(\"DF-L5-uniqueCategories-1\", Row(\"Apache Spark\"), results(1))\ndbTest(\"DF-L5-uniqueCategories-2\", Row(\"Company Blog\"), results(2))\n\ndbTest(\"DF-L5-uniqueCategories-9\", Row(\"Platform\"), results(9))\ndbTest(\"DF-L5-uniqueCategories-10\", Row(\"Product\"), results(10))\ndbTest(\"DF-L5-uniqueCategories-11\", Row(\"Streaming\"), results(11))\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"30fb7d0d-7f65-4b48-b54b-f2d55526eed0"},{"version":"CommandV1","origId":1745794912674998,"guid":"73301f95-c7fd-4fb8-849a-d98b0e020d2d","subtype":"command","commandType":"auto","position":52.0,"command":"%md\n### Step 2\nShow the complete list of categories.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ab3b23a6-6e8a-4af8-86f1-845a1b96b4b2"},{"version":"CommandV1","origId":1745794912674999,"guid":"184e67cb-e34c-4014-a00c-4c3702f482af","subtype":"command","commandType":"auto","position":53.0,"command":"// ANSWER\n\ndisplay(uniqueCategoriesDF.orderBy($\"category\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"49c26356-6e44-4517-8a85-180e65c1dfd0"},{"version":"CommandV1","origId":1745794912675000,"guid":"eccef80c-0803-4c86-94ae-b0f064c5a8b0","subtype":"command","commandType":"auto","position":54.0,"command":"%md\n## Exercise 3\n\nCount how many times each category is referenced in the Databricks blog.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"216b0b11-8160-4cfd-8dc0-f2bcc50bf373"},{"version":"CommandV1","origId":1745794912675001,"guid":"ed2e67f8-61c4-4770-af76-6ac2201be613","subtype":"command","commandType":"auto","position":55.0,"command":"%md-sandbox\n### Step 1\n\nStarting with the `databricksBlogDF` DataFrame, create another DataFrame called `totalArticlesByCategoryDF` where:\n0. The new DataFrame contains two columns, `category` and `total`.\n0. The `category` column is a single, distinct category (similar to the last exercise).\n0. The `total` column is the total number of articles in that category.\n0. Order by `category`.\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> Because articles can be tagged with multiple categories, the sum of the totals adds up to more than the total number of articles.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6436cb42-1dbb-4a85-a04a-adc1263100b9"},{"version":"CommandV1","origId":1745794912675002,"guid":"eb3de3b3-eb37-471a-ba00-10e392372b25","subtype":"command","commandType":"auto","position":56.0,"command":"// ANSWER\n\nimport org.apache.spark.sql.functions.count\nval totalArticlesByCategoryDF = databricksBlogDF\n  .select(explode($\"categories\") as \"category\")\n  .groupBy($\"category\")\n  .agg(count(\"*\").alias(\"total\"))\n  .orderBy($\"category\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7a401abe-7c39-486a-9a0e-f720c7ab2ffc"},{"version":"CommandV1","origId":1745794912675003,"guid":"c8a08167-2c41-4c18-9732-394118c2061a","subtype":"command","commandType":"auto","position":57.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val results = totalArticlesByCategoryDF.count()\ndbTest(\"DF-L5-articlesByCategory-count\", 12, results)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7115b6e3-2e96-40cc-8b47-b2581dcadfe0"},{"version":"CommandV1","origId":1745794912675004,"guid":"b00ea359-9394-47e0-93a0-30f3a8d45c74","subtype":"command","commandType":"auto","position":58.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val results = totalArticlesByCategoryDF.collect()\ndbTest(\"DF-L5-articlesByCategory-0\", Row(\"Announcements\",72), results(0))\ndbTest(\"DF-L5-articlesByCategory-1\", Row(\"Apache Spark\",132), results(1))\ndbTest(\"DF-L5-articlesByCategory-2\", Row(\"Company Blog\",224), results(2))\n\ndbTest(\"DF-L5-articlesByCategory-9\", Row(\"Platform\",4), results(9))\ndbTest(\"DF-L5-articlesByCategory-10\", Row(\"Product\",83), results(10))\ndbTest(\"DF-L5-articlesByCategory-11\", Row(\"Streaming\",21), results(11))\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"56ff3fc3-15b4-4f6a-af3e-24d9a32e1bfe"},{"version":"CommandV1","origId":1745794912675005,"guid":"f247bc8d-0848-4497-b54d-4ec4c6dffa21","subtype":"command","commandType":"auto","position":59.0,"command":"%md\n### Step 2\nDisplay the totals of each category in html format (should be ordered by `category`).","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"20ba9c18-843e-46f7-b30e-45ef47ce9c57"},{"version":"CommandV1","origId":1745794912675006,"guid":"c4567b5a-4ff2-4a42-9273-f7ba9fc2e138","subtype":"command","commandType":"auto","position":60.0,"command":"// ANSWER\ndisplay(totalArticlesByCategoryDF)","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8ebbae26-fbdb-438b-ac21-47972351b5f0"},{"version":"CommandV1","origId":1745794912675007,"guid":"0ce6af10-b02b-4362-8c78-6aef4be36b5f","subtype":"command","commandType":"auto","position":61.0,"command":"%md\n## Summary\n\n* Spark DataFrames allows you to query and manipulate structured and semi-structured data.\n* Spark DataFrames built-in functions provide powerful primitives for querying complex schemas.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"94956ff2-ef70-404f-9eb7-ab0369057b94"},{"version":"CommandV1","origId":1745794912675008,"guid":"f3824e59-8a58-458f-80b7-424219d21e5d","subtype":"command","commandType":"auto","position":62.0,"command":"%md\n## Review Questions\n**Q:** What is the syntax for accessing nested columns?  \n**A:** Use the dot notation:`select($\"dates.publishedOn\")`\n\n**Q:** What is the syntax for accessing the first element in an array?  \n**A:** Use the [subscript] notation: `select($\"authors\"(0))`\n\n**Q:** What is the syntax for expanding an array into multiple rows?  \n**A:** Use the explode method:  `select(explode($\"authors\") as \"Author\")`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d4fcd1d2-4353-40bb-96a4-cb86d494be13"},{"version":"CommandV1","origId":1745794912675009,"guid":"4229740f-e8f9-44e1-9c2b-484b06441ef6","subtype":"command","commandType":"auto","position":63.0,"command":"%md\n## Next Steps\n\nStart the next lesson, [Querying Data Lakes with DataFrames]($./06-Data-Lakes).","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"eb9c5e59-2461-4ca4-88b2-1560d2ba49d6"},{"version":"CommandV1","origId":1745794912675010,"guid":"4f0514a8-73d0-407b-b034-f17df64854ef","subtype":"command","commandType":"auto","position":64.0,"command":"%md\n## Additional Topics & Resources\n\n* <a href=\"http://spark.apache.org/docs/latest/sql-programming-guide.html\" target=\"_blank\">Spark SQL, DataFrames and Datasets Guide</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8288a202-10c0-45b3-b88f-9f82bef0c8c9"}],"dashboards":[],"guid":"eea04fc9-c958-40c1-869b-a22a0afe26d6","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}