{"version":"NotebookV1","origId":1745794912675107,"name":"Exploratory-Data-Analysis","language":"scala","commands":[{"version":"CommandV1","origId":1745794912675108,"guid":"23a5701e-7568-4844-8000-7ffd3bdcfd84","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Project: Exploratory Data Analysis\nPerform exploratory data analysis (EDA) to gain insights from a data lake.\n\n## Instructions\n\nIn `dbfs:/mnt/training/crime-data-2016`, there are a number of Parquet files containing 2016 crime data from seven United States cities:\n\n* New York\n* Los Angeles\n* Chicago\n* Philadelphia\n* Dallas\n* Boston\n\nThe data is cleaned up a little, but has not been normalized. Each city reports crime data slightly differently, so\nexamine the data for each city to determine how to query it properly.\n\nYour job is to use some of this data to gain insights about certain kinds of crimes.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"baa5e57c-038b-43e7-84f8-4f9d8b727f88"},{"version":"CommandV1","origId":1745794912675109,"guid":"34a5a65b-0ce8-4278-979f-ac20a58ef57c","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n### Getting Started\n\nRun the following cell to configure our \"classroom.\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e4c28b74-c6b4-4746-b987-a0c078c251c9"},{"version":"CommandV1","origId":1745794912675110,"guid":"cbb3f10b-162c-41ca-be22-948d11c61ea8","subtype":"command","commandType":"auto","position":4.0,"command":"%run ../Includes/Classroom-Setup","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d8404429-d377-401f-99d7-4452ecc536fa"},{"version":"CommandV1","origId":1745794912675111,"guid":"db0feb6d-09df-40c1-b500-68904a8de690","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n## Step 1\n\nStart by creating DataFrames for Los Angeles, Philadelphia, and Dallas data.\n\nUse `spark.read.parquet` to create named DataFrames for the files you choose. \n\nTo read in the parquet file, use `val crimeDataNewYorkDF = spark.read.parquet(\"/mnt/training/crime-data-2016/Crime-Data-New-York-2016.parquet\")`\n\nUse the following view names:\n\n| City          | DataFrame Name            | Path to DBFS file\n| ------------- | ------------------------- | -----------------\n| Los Angeles   | `crimeDataLosAngelesDF`   | `dbfs:/mnt/training/crime-data-2016/Crime-Data-Los-Angeles-2016.parquet`\n| Philadelphia  | `crimeDataPhiladelphiaDF` | `dbfs:/mnt/training/crime-data-2016/Crime-Data-Philadelphia-2016.parquet`\n| Dallas        | `crimeDataDallasDF`       | `dbfs:/mnt/training/crime-data-2016/Crime-Data-Dallas-2016.parquet`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"396ae985-731b-45fb-8c2f-593f40a7fd69"},{"version":"CommandV1","origId":1745794912675112,"guid":"9e65399f-257d-4420-8ea6-7b7b5eddb993","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"720e635c-d822-4659-a661-9c92b3f199dc"},{"version":"CommandV1","origId":1745794912675113,"guid":"3c377519-35f1-4fb3-bb6e-2605976e1121","subtype":"command","commandType":"auto","position":7.0,"command":"// ANSWER\nval crimeDataLosAngelesDF = spark.read.parquet(\"/mnt/training/crime-data-2016/Crime-Data-Los-Angeles-2016.parquet\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8294b54c-1ba3-41d7-bac8-33f51578ceee"},{"version":"CommandV1","origId":1745794912675114,"guid":"fc1a7473-8cdc-4c7a-8fe1-21e9ef17cf55","subtype":"command","commandType":"auto","position":8.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val rowsLosAngeles  = crimeDataLosAngelesDF.count()\ndbTest(\"DF-L7-crimeDataLA-count\", rowsLosAngeles, 217945)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ca13e9d7-90a1-41bb-a794-d9cec432bdbf"},{"version":"CommandV1","origId":1745794912675115,"guid":"c23cf580-cd6f-4a44-b153-75216f2967f5","subtype":"command","commandType":"auto","position":9.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"19b1aa63-c90f-4075-8bcc-a6f111c3716e"},{"version":"CommandV1","origId":1745794912675116,"guid":"acfc7138-12ea-4044-a154-e949225acb00","subtype":"command","commandType":"auto","position":10.0,"command":"// ANSWER\n\nval crimeDataPhiladelphiaDF = spark.read.parquet(\"/mnt/training/crime-data-2016/Crime-Data-Philadelphia-2016.parquet\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"00c3c11a-0256-4288-887a-b0e5ebcf1917"},{"version":"CommandV1","origId":1745794912675117,"guid":"c1bd1b66-a29f-4106-a64a-e64b55c99b91","subtype":"command","commandType":"auto","position":11.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val rowsPhiladelphia  = crimeDataPhiladelphiaDF.count()\ndbTest(\"DF-L7-crimeDataPA-count\", rowsPhiladelphia, 168664)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"90f3af8f-fe38-4041-b1e3-b73e1b8bc01c"},{"version":"CommandV1","origId":1745794912675118,"guid":"a84ff98a-12a6-4d44-ab46-9d0da7a361e1","subtype":"command","commandType":"auto","position":12.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"466f9402-9d1e-4215-83af-7564a455b207"},{"version":"CommandV1","origId":1745794912675119,"guid":"ce0ffcf3-5328-454f-aab8-6cfa7816af51","subtype":"command","commandType":"auto","position":13.0,"command":"// ANSWER\n\nval crimeDataDallasDF = spark.read.parquet(\"/mnt/training/crime-data-2016/Crime-Data-Dallas-2016.parquet\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fd1a7d97-e42d-40bf-b558-2b4abb731f6d"},{"version":"CommandV1","origId":1745794912675120,"guid":"df990dd1-96c4-45a8-9d1a-c5ecb06146cd","subtype":"command","commandType":"auto","position":14.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val rowsDallas  = crimeDataDallasDF.count()\ndbTest(\"DF-L7-crimeDataDAL-count\", 99642, rowsDallas)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4e7de051-d624-43b3-9eb2-6514d64857ac"},{"version":"CommandV1","origId":1745794912675121,"guid":"9b178625-5e5b-45b4-bdb6-832baf8ee7c6","subtype":"command","commandType":"auto","position":15.0,"command":"%md-sandbox\n## Step 2\n\nFor each table, examine the data to figure out how to extract _robbery_ statistics.\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> Each city uses different values to indicate robbery. Commonly used terminology is \"larceny\", \"burglary\" or \"robbery.\"  These challenges are common in Data Lakes.  Restrict yourself to only robberies.\n\nExplore the data for the three cities until you understand how each city records robbery information. If you don't want to worry about upper- or lower-case, \nremember to use the DataFrame `lower()` method to converts column values to lowercase.\n\nCreate a DataFrame containing only the robbery-related rows, as shown in the table below.\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** For each table, focus your efforts on the column listed below.\n\nFocus on the following columns for each table:\n\n| DataFrame Name            | Robbery DataFrame Name  | Column\n| ------------------------- | ----------------------- | -------------------------------\n| `crimeDataLosAngelesDF`   | `robberyLosAngelesDF`   | `crimeCodeDescription`\n| `crimeDataPhiladelphiaDF` | `robberyPhiladelphiaDF` | `ucr_general_description`\n| `crimeDataDallasDF`       | `robberyDallasDF`       | `typeOfIncident`","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d144839d-84e5-4345-9e3a-85ed589c743e"},{"version":"CommandV1","origId":1745794912675122,"guid":"c1943153-8cdd-4cdc-9016-3122c486b45e","subtype":"command","commandType":"auto","position":16.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"02b8cb9c-f952-4c08-933d-58d4a97b9c11"},{"version":"CommandV1","origId":1745794912675123,"guid":"cb4c842b-6f6f-45a7-af5e-ab0aab674903","subtype":"command","commandType":"auto","position":17.0,"command":"// ANSWER\nimport org.apache.spark.sql.functions.lower\nval robberyLosAngelesDF = crimeDataLosAngelesDF.filter(lower($\"crimeCodeDescription\") === \"robbery\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fc3bf32f-5a75-42e7-bfbb-5e95492b3199"},{"version":"CommandV1","origId":1745794912675124,"guid":"a4827567-47fe-4598-9f42-fba3553c92b7","subtype":"command","commandType":"auto","position":18.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val totalLosAngeles  = robberyLosAngelesDF.count()\ndbTest(\"DF-L7-robberyDataLA-count\", 9048, totalLosAngeles)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"654adf8e-93e9-4736-b07f-1ba8be03e0d7"},{"version":"CommandV1","origId":1745794912675125,"guid":"8b651fb6-d802-49e7-8d01-db1da8f7ebed","subtype":"command","commandType":"auto","position":19.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"57550b08-4067-4ff9-bacc-a7ade0f43399"},{"version":"CommandV1","origId":1745794912675126,"guid":"211f09e3-bdc3-4c9a-9662-b6adab678380","subtype":"command","commandType":"auto","position":20.0,"command":"// ANSWER\n\nval robberyPhiladelphiaDF = crimeDataPhiladelphiaDF.filter(lower($\"ucr_general_description\") === \"robbery\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2c529fe2-b7f4-4c7d-a4b1-951c7af63279"},{"version":"CommandV1","origId":1745794912675127,"guid":"2b8c71a8-68f3-462a-a5a8-1afea0747228","subtype":"command","commandType":"auto","position":21.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val totalPhiladelphia  = robberyPhiladelphiaDF.count()\ndbTest(\"DF-L7-robberyDataPA-count\", 6149, totalPhiladelphia)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"abdf37e5-9e2b-44d8-b2c4-5cdca7228dcc"},{"version":"CommandV1","origId":1745794912675128,"guid":"9ddb93d9-68c1-4f0c-8b84-ca3c1b3749e6","subtype":"command","commandType":"auto","position":22.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"02320962-9ab8-4361-8647-81b4ff7bbf54"},{"version":"CommandV1","origId":1745794912675129,"guid":"5768c3ce-c165-4d87-b8e3-8bd1e5b4b0ea","subtype":"command","commandType":"auto","position":23.0,"command":"// ANSWER\nval robberyDallasDF = crimeDataDallasDF.filter(lower($\"typeOfIncident\").startsWith(\"robbery\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"925111b7-a57c-4f12-9d74-a7c6199b20c5"},{"version":"CommandV1","origId":1745794912675130,"guid":"72f2800f-edf3-434c-b859-ff3cfe49909d","subtype":"command","commandType":"auto","position":24.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val totalDallas = robberyDallasDF.count()\ndbTest(\"DF-L7-robberyDataDAL-count\", 6824, totalDallas)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"762674a7-49dc-47c5-864d-e5d4a405b60b"},{"version":"CommandV1","origId":1745794912675131,"guid":"37bd0eef-5174-4465-a8a4-74f49f89c533","subtype":"command","commandType":"auto","position":25.0,"command":"%md-sandbox\n## Step 3\n\nNow that you have DataFrames of only the robberies in each city, create DataFrames for each city summarizing the number of robberies in each month.\n\nYour DataFrames must contain two columns:\n* `month`: The month number (e.g., 1 for January, 2 for February, etc.).\n* `robberies`: The total number of robberies in the month.\n\nUse the following DataFrame names and date columns:\n\n\n| City          | DataFrame Name     | Date Column \n| ------------- | ------------- | -------------\n| Los Angeles   | `robberiesByMonthLosAngelesDF` | `timeOccurred`\n| Philadelphia  | `robberiesByMonthPhiladelphiaDF` | `dispatch_date_time`\n| Dallas        | `robberiesByMonthDallasDF` | `startingDateTime`\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> For each city, figure out which column contains the date of the incident. Then, extract the month from that date.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"781a8de6-7c43-4a48-92fd-29cbdd0aba23"},{"version":"CommandV1","origId":1745794912675132,"guid":"df3b84aa-ec10-4f57-8446-0c47b5e2d362","subtype":"command","commandType":"auto","position":26.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dfa24e38-0b31-4774-a908-519a7ee6bbd4"},{"version":"CommandV1","origId":1745794912675133,"guid":"34501f61-dd89-48ba-a20b-7a65ca85d151","subtype":"command","commandType":"auto","position":27.0,"command":"// ANSWER\nimport org.apache.spark.sql.functions.{month,count}\nval robberiesByMonthLosAngelesDF = robberyLosAngelesDF\n  .select(month($\"timeOccurred\") as \"month\")\n  .groupBy($\"month\")  \n  .agg(count(\"*\") as \"robberies\")\n  .orderBy($\"month\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"315b9abb-93d2-4e14-a585-8efa2aa07e6b"},{"version":"CommandV1","origId":1745794912675134,"guid":"66667331-741b-4289-8d29-f8044d30b0d6","subtype":"command","commandType":"auto","position":28.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val la = robberiesByMonthLosAngelesDF.collect().toList\ndbTest(\"DF-L7-robberyByMonthLA-counts\", List(Row(1,719), Row(2,675), Row(3,709), Row(4,713), Row(5,790), Row(6,698), Row(7,826), Row(8,765), Row(9,722), Row(10,814), Row(11,764), Row(12,853)), la)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"14b1c6e0-d96c-40f0-9460-74d1a412c31f"},{"version":"CommandV1","origId":1745794912675135,"guid":"b905e6d2-8a77-4e9b-85e0-7bf4438b7f6f","subtype":"command","commandType":"auto","position":29.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"549c10bb-0490-427b-ab6c-7e3c6a1a45bc"},{"version":"CommandV1","origId":1745794912675136,"guid":"903709b3-2ad5-4dac-97cd-48fe525a0c59","subtype":"command","commandType":"auto","position":30.0,"command":"// ANSWER\nimport org.apache.spark.sql.functions._\n\nval robberiesByMonthPhiladelphiaDF = robberyPhiladelphiaDF\n  .select(month($\"dispatch_date_time\") as \"month\")\n  .groupBy($\"month\")  \n  .agg(count(\"*\") as \"robberies\")\n  .orderBy($\"month\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"64e3889a-3b40-4ed3-ad6f-c6fdc732c8fb"},{"version":"CommandV1","origId":1745794912675137,"guid":"c9471c59-ce21-464c-a0c4-c8ada2f8ce01","subtype":"command","commandType":"auto","position":31.0,"command":"// TEST - Run this cell to test your solution.\n// convert to list so that we get deep compare (Array would be a shallow compare)\nlazy val philadelphia  = robberiesByMonthPhiladelphiaDF.collect().toList\ndbTest(\"DF-L7-robberyByMonthPA-counts\", List(Row(1,520), Row(2,416), Row(3,432), Row(4,466), Row(5,533), Row(6,509), Row(7,537), Row(8,561), Row(9,514), Row(10,572), Row(11,545), Row(12,544)), philadelphia)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d1c274d9-087e-45de-938d-371532d93ab2"},{"version":"CommandV1","origId":1745794912675138,"guid":"2a881bfc-ccc8-4f23-a86c-1ff8fea874c3","subtype":"command","commandType":"auto","position":32.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dcb25b38-89e7-4494-9888-dc7b69fb64bc"},{"version":"CommandV1","origId":1745794912675139,"guid":"1f591c8f-905a-4b69-a33f-c5d97fd6dea0","subtype":"command","commandType":"auto","position":33.0,"command":"// ANSWER\nimport org.apache.spark.sql.functions._\n\nval robberiesByMonthDallasDF = robberyDallasDF\n  .select(month($\"startingDateTime\") as \"month\")\n  .groupBy($\"month\")  \n  .agg(count(\"*\") as \"robberies\")\n  .orderBy($\"month\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4bdafbb0-48f4-4348-9930-70bcccbc1bdf"},{"version":"CommandV1","origId":1745794912675140,"guid":"febe500c-3976-4cec-a9f1-464435eda408","subtype":"command","commandType":"auto","position":34.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val dallas  = robberiesByMonthDallasDF.collect().toList\ndbTest(\"DF-L7-robberyByMonthDAL-counts\", List(Row(1, 743), Row(2, 435), Row(3,412), Row(4,594), Row(5,615), Row(6,495), Row(7,535), Row(8,627), Row(9,512), Row(10,603), Row(11,589), Row(12,664)), dallas)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"808ae622-59fb-46bb-9d4c-79a1b6682722"},{"version":"CommandV1","origId":1745794912675141,"guid":"52a16f5d-b4a9-4df7-9f59-7f52490e1b97","subtype":"command","commandType":"auto","position":35.0,"command":"%md-sandbox\n\n## Step 4\n\nPlot the robberies per month for each of the three cities, producing a plot similar to the following:\n\n<img src=\"https://files.training.databricks.com/images/eLearning/robberies-by-month.png\" style=\"max-width: 700px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n\nWhen you first run the cell, you'll get an HTML table as the result. To configure the plot:\n\n1. Click the graph button.\n2. If the plot doesn't look correct, click the **Plot Options** button.\n3. Configure the plot similar to the following example.\n\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-1.png\" style=\"width: 440px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-2.png\" style=\"width: 268px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-3.png\" style=\"width: 362px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b869ba58-9010-4e12-9325-48feb97a2f5d"},{"version":"CommandV1","origId":1745794912675142,"guid":"6129567d-9bb6-42ff-a845-d9837b3124ba","subtype":"command","commandType":"auto","position":36.0,"command":"%md\n#### Los Angeles","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9a201023-25ea-437d-bb9e-cb0be8a240fd"},{"version":"CommandV1","origId":1745794912675143,"guid":"8ca3f94b-0510-4e21-a534-4bdbd23a1e56","subtype":"command","commandType":"auto","position":37.0,"command":"// ANSWER\ndisplay(robberiesByMonthLosAngelesDF.orderBy($\"month\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"22eb4f7f-67ee-494d-8a74-fff5d0db5406"},{"version":"CommandV1","origId":1745794912675144,"guid":"2090dc00-ce0d-408e-94d6-7c17f458234b","subtype":"command","commandType":"auto","position":38.0,"command":"%md\n#### Philadelphia","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1ff4d9cc-bf28-4a91-af03-e6ded08613bc"},{"version":"CommandV1","origId":1745794912675145,"guid":"0abb4d3e-015c-4a08-a403-6805159736d3","subtype":"command","commandType":"auto","position":39.0,"command":"// ANSWER\ndisplay(robberiesByMonthPhiladelphiaDF.orderBy($\"month\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bbc6df87-2840-45f1-8e12-402aab469e75"},{"version":"CommandV1","origId":1745794912675146,"guid":"d142c7d7-31f7-4fa6-9178-9bb1aa87dd44","subtype":"command","commandType":"auto","position":40.0,"command":"%md\n#### Dallas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"816e32d7-51ce-4be6-b7c9-ac30cc79f9da"},{"version":"CommandV1","origId":1745794912675147,"guid":"94484e94-cc5d-4d80-b6a4-479b8d58cfe2","subtype":"command","commandType":"auto","position":41.0,"command":"// ANSWER\ndisplay(robberiesByMonthDallasDF.orderBy($\"month\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bf2111ba-67f8-4fd8-a95c-1d60d841905e"},{"version":"CommandV1","origId":1745794912675148,"guid":"eb0c9e1b-3e98-40a9-8de5-9872a860c754","subtype":"command","commandType":"auto","position":42.0,"command":"%md-sandbox\n## Step 5\n\nCreate another DataFrame called `combinedRobberiesByMonthDF`, that combines all three robberies-per-month views into one.\nIn creating this view, add a new column called `city`, that identifies the city associated with each row.\nThe final view will have the following columns:\n\n* `city`: The name of the city associated with the row. (Use the strings \"Los Angeles\", \"Philadelphia\", and \"Dallas\".)\n* `month`: The month number associated with the row.\n* `robbery`: The number of robbery in that month (for that city).\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** You may want to apply the `union()` method in this example to combine the three datasets.\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** It's easy to add new columns in DataFrames. For example, add a new column called `newColumn` to `originalDF` use `withColumn()` method as follows:\n\n```originalDF.withColumn(\"newColumn\")``` ","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"757bad25-b3f9-4e91-aead-eb33f267574f"},{"version":"CommandV1","origId":1745794912675149,"guid":"d1c29d54-94d9-4a84-8368-ba4d134f822a","subtype":"command","commandType":"auto","position":43.0,"command":"// ANSWER\n\nval combinedRobberiesByMonthDF = robberiesByMonthLosAngelesDF.select(lit(\"Los Angeles\").as(\"city\"), $\"*\")\n  .union(robberiesByMonthPhiladelphiaDF.select(lit(\"Philadelphia\").as(\"city\"), $\"*\"))\n  .union(robberiesByMonthDallasDF.select(lit(\"Dallas\").as(\"city\"), $\"*\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"54be5e5a-9bab-4a83-a97c-f26eb46cd4ed"},{"version":"CommandV1","origId":1745794912675150,"guid":"a83d382f-de1a-4a2c-9b64-dd8a933b0e07","subtype":"command","commandType":"auto","position":44.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val results = combinedRobberiesByMonthDF.collect().toSet\n           \ndbTest(\"DF-L7-combinedRobberiesByMonth-counts\", Set(Row(\"Dallas\",11,589), Row(\"Los Angeles\",2,675), Row(\"Dallas\",8,627), Row(\"Los Angeles\",9,722), Row(\"Los Angeles\",1,719), Row(\"Philadelphia\",12,544), Row(\"Dallas\",1,743), Row(\"Dallas\",10,603), Row(\"Dallas\",6,495), Row(\"Los Angeles\",4,713), Row(\"Philadelphia\",2,416), Row(\"Dallas\",4,594), Row(\"Los Angeles\",12,853), Row(\"Dallas\",12,664), Row(\"Dallas\",9,512), Row(\"Los Angeles\",3,709), Row(\"Dallas\",2,435), Row(\"Los Angeles\",7,826), Row(\"Philadelphia\",1,520), Row(\"Los Angeles\",5,790), Row(\"Philadelphia\",7,537), Row(\"Dallas\",5,615), Row(\"Philadelphia\",9,514), Row(\"Los Angeles\",6,698), Row(\"Philadelphia\",8,561), Row(\"Los Angeles\",11,764), Row(\"Philadelphia\",6,509), Row(\"Dallas\",3,412), Row(\"Philadelphia\",5,533), Row(\"Philadelphia\",10,572), Row(\"Los Angeles\",10,814), Row(\"Los Angeles\",8,765), Row(\"Philadelphia\",11,545), Row(\"Dallas\",7,535), Row(\"Philadelphia\",3,432), Row(\"Philadelphia\",4,466)), results)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7fb92833-38cb-4c06-9d06-a94dcb523bae"},{"version":"CommandV1","origId":1745794912675151,"guid":"000c6408-0719-4611-a3f7-74cd4f316af1","subtype":"command","commandType":"auto","position":45.0,"command":"combinedRobberiesByMonthDF.select($\"city\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"87997c58-12bf-4171-af8d-59c322a49a82"},{"version":"CommandV1","origId":1745794912675152,"guid":"d5c065fa-8b7d-4d95-8307-3d74fe5ff858","subtype":"command","commandType":"auto","position":46.0,"command":"%md-sandbox\n## Step 6\n\nGraph the contents of `combinedRobberiesByMonthDF`, producing a graph similar to the following. (The diagram below deliberately\nuses different data.)\n\n<img src=\"https://files.training.databricks.com/images/eLearning/combined-homicides.png\" style=\"width: 800px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n\nAdjust the plot options to configure the plot properly, as shown below:\n\n<img src=\"https://files.training.databricks.com/images/eLearning/capstone-plot-4.png\" style=\"width: 362px; margin: 10px; border: 1px solid #aaaaaa; border-radius: 10px 10px 10px 10px\"/>\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** Order your results by `month`, then `city`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"44785aa9-8f2f-4c96-9947-89f5a11d11f9"},{"version":"CommandV1","origId":1745794912675153,"guid":"c901e528-9c70-40da-92d4-12d57c924148","subtype":"command","commandType":"auto","position":47.0,"command":"// ANSWER\n\ndisplay(combinedRobberiesByMonthDF.orderBy($\"month\", $\"city\"))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d02c98d4-e7b2-4d8e-b831-a9da9115cfc9"},{"version":"CommandV1","origId":1745794912675154,"guid":"0fe725f0-d4dc-43f2-98c6-e0e1d06973ac","subtype":"command","commandType":"auto","position":48.0,"command":"%md\n## Step 7\n\nWhile the above graph is interesting, it's flawed: it's comparing the raw numbers of robberies, not the per capita robbery rates.\n\nThe DataFrame (already created) called `cityDataDF`  contains, among other data, estimated 2016 population values for all United States cities\nwith populations of at least 100,000. (The data is from [Wikipedia](https://en.wikipedia.org/wiki/List_of_United_States_cities_by_population).)\n\n* Use the population values in that table to normalize the robberies so they represent per-capita values (total robberies divided by population).\n* Save your results in a DataFrame called `robberyRatesByCityDF`.\n* The robbery rate value must be stored in a new column, `robberyRate`.\n\nNext, graph the results, as above.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b39f96ca-1afc-4fec-a667-bcac1e01b110"},{"version":"CommandV1","origId":1745794912675155,"guid":"f491e4ac-acfc-46e3-bbc8-6440f218d42c","subtype":"command","commandType":"auto","position":49.0,"command":"// ANSWER\n\n// rename \"city\" column to \"cities\" to avoid having two similarly named cols; also columns are case-blind\nval cityDataDF = spark.read.parquet(\"dbfs:/mnt/training/City-Data.parquet\").withColumnRenamed(\"city\", \"cities\")\n\nval robberyRatesByCityDF = combinedRobberiesByMonthDF\n  .select($\"month\", $\"robberies\", $\"city\")\n  .join(cityDataDF, combinedRobberiesByMonthDF(\"city\") === cityDataDF(\"cities\"))\n  .withColumn(\"robberyRate\", format_number($\"robberies\"/$\"estPopulation2016\",6))\n  .drop($\"robberies\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"091c095e-a73d-4b91-a40e-306449f1f427"},{"version":"CommandV1","origId":1745794912675156,"guid":"b37347d8-5b5a-41e4-8fd5-972b8c3cad4d","subtype":"command","commandType":"auto","position":50.0,"command":"// TEST - Run this cell to test your solution.\nlazy val results = robberyRatesByCityDF.select($\"city\", $\"month\", $\"robberyRate\").orderBy($\"city\", $\"month\").collect.toList\nlazy val expectedResults = List(\n  Row(\"Dallas\",  1, \"0.000564\"),\n  Row(\"Dallas\",  2, \"0.000330\"),\n  Row(\"Dallas\",  3, \"0.000313\"),\n  Row(\"Dallas\",  4, \"0.000451\"), \n  Row(\"Dallas\",  5, \"0.000467\"),\n  Row(\"Dallas\",  6, \"0.000376\"),\n  Row(\"Dallas\",  7, \"0.000406\"),\n  Row(\"Dallas\",  8, \"0.000476\"),\n  Row(\"Dallas\",  9, \"0.000388\"),\n  Row(\"Dallas\", 10, \"0.000458\"), \n  Row(\"Dallas\", 11, \"0.000447\"),\n  Row(\"Dallas\", 12, \"0.000504\"), \n  Row(\"Los Angeles\",  1, \"0.000181\"),\n  Row(\"Los Angeles\",  2, \"0.000170\"),\n  Row(\"Los Angeles\",  3, \"0.000178\"), \n  Row(\"Los Angeles\",  4, \"0.000179\"), \n  Row(\"Los Angeles\",  5, \"0.000199\"),\n  Row(\"Los Angeles\",  6, \"0.000176\"),\n  Row(\"Los Angeles\",  7, \"0.000208\"),\n  Row(\"Los Angeles\",  8, \"0.000192\"), \n  Row(\"Los Angeles\",  9, \"0.000182\"), \n  Row(\"Los Angeles\", 10, \"0.000205\"),\n  Row(\"Los Angeles\", 11, \"0.000192\"), \n  Row(\"Los Angeles\", 12, \"0.000215\"),\n  Row(\"Philadelphia\",  1, \"0.000332\"),\n  Row(\"Philadelphia\",  2, \"0.000265\"), \n  Row(\"Philadelphia\",  3, \"0.000276\"),\n  Row(\"Philadelphia\",  4, \"0.000297\"), \n  Row(\"Philadelphia\",  5, \"0.000340\"),\n  Row(\"Philadelphia\",  6, \"0.000325\"),\n  Row(\"Philadelphia\",  7, \"0.000343\"),\n  Row(\"Philadelphia\",  8, \"0.000358\"),\n  Row(\"Philadelphia\",  9, \"0.000328\"),\n  Row(\"Philadelphia\", 10, \"0.000365\"),\n  Row(\"Philadelphia\", 11, \"0.000348\"), \n  Row(\"Philadelphia\", 12, \"0.000347\"))\ndbTest(\"DF-L7-roberryRatesByCity-counts\", expectedResults, results)\n\nprintln(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7f9ad20c-9d4d-42d8-8d85-8a73e352b98f"},{"version":"CommandV1","origId":1745794912675157,"guid":"2747b5d4-ed3e-4fd7-8ad0-a161c785418d","subtype":"command","commandType":"auto","position":52.0,"command":"%md\n## References\n\nThe crime data used in this notebook comes from the following locations:\n\n| City          | Original Data \n| ------------- | -------------\n| Boston        | <a href=\"https://data.boston.gov/group/public-safety\" target=\"_blank\">https&#58;//data.boston.gov/group/public-safety</a>\n| Chicago       | <a href=\"https://data.cityofchicago.org/Public-Safety/Crimes-2001-to-present/ijzp-q8t2\" target=\"_blank\">https&#58;//data.cityofchicago.org/Public-Safety/Crimes-2001-to-present/ijzp-q8t2</a>\n| Dallas        | <a href=\"https://www.dallasopendata.com/Public-Safety/Police-Incidents/tbnj-w5hb/data\" target=\"_blank\">https&#58;//www.dallasopendata.com/Public-Safety/Police-Incidents/tbnj-w5hb/data</a>\n| Los Angeles   | <a href=\"https://data.lacity.org/A-Safe-City/Crime-Data-From-2010-to-Present/y8tr-7khq\" target=\"_blank\">https&#58;//data.lacity.org/A-Safe-City/Crime-Data-From-2010-to-Present/y8tr-7khq</a>\n| New Orleans   | <a href=\"https://data.nola.gov/Public-Safety-and-Preparedness/Electronic-Police-Report-2016/4gc2-25he/data\" target=\"_blank\">https&#58;//data.nola.gov/Public-Safety-and-Preparedness/Electronic-Police-Report-2016/4gc2-25he/data</a>\n| New York      | <a href=\"https://data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Historic/qgea-i56i\" target=\"_blank\">https&#58;//data.cityofnewyork.us/Public-Safety/NYPD-Complaint-Data-Historic/qgea-i56i</a>\n| Philadelphia  | <a href=\"https://www.opendataphilly.org/dataset/crime-incidents\" target=\"_blank\">https&#58;//www.opendataphilly.org/dataset/crime-incidents</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e28ed457-6ac1-4299-8221-50486cbbfa9e"}],"dashboards":[],"guid":"566031bd-61f9-4ab5-a892-bd3d75e1f6ff","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}