{"version":"NotebookV1","origId":1745794912681815,"name":"01S-Querying-Files","language":"python","commands":[{"version":"CommandV1","origId":1745794912681816,"guid":"ea37def6-e9d5-4632-a262-e572a708d946","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Querying Files with SQL\n\nApache Spark&trade; and Azure Databricks&reg; allow you to use SQL to query large data files.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d48bc8d5-199e-46b1-950a-d42298284990"},{"version":"CommandV1","origId":1745794912681817,"guid":"ecbc4bfb-8bab-4d56-9639-cdcfbceaf839","subtype":"command","commandType":"auto","position":3.0,"command":"%md-sandbox\n### Getting Started\n\nRun the following cell to configure our \"classroom.\"\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> Remember to attach your notebook to a cluster by clicking \"Detached\" in the upper left hand corner and then choosing your preferred cluster\n\n<img src=\"https://files.training.databricks.com/images/eLearning/attach-to-cluster.png\" style=\"border: 1px solid #aaa; border-radius: 10px 10px 10px 10px; box-shadow: 5px 5px 5px #aaa\"/>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"56e08948-ad80-4ac8-9303-cd8a5bf64364"},{"version":"CommandV1","origId":1745794912681818,"guid":"b5d0500c-5011-4351-a325-6065d4064dc5","subtype":"command","commandType":"auto","position":4.0,"command":"%run \"./Includes/Classroom-Setup\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9ae152c5-c39c-4aa5-9d5b-8a9b44f0e448"},{"version":"CommandV1","origId":1745794912681819,"guid":"ccab1919-cf33-4337-94cf-0932de7645d9","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n### Querying Tables\nThis lesson uses the table `People10m`. \n\nThe data is fictitious; in particular, the Social Security numbers are fake.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"faf4730e-69a6-4062-add4-0b14f02b81f5"},{"version":"CommandV1","origId":1745794912681820,"guid":"ec26c3ca-7d5e-4d9c-a143-7243f734b141","subtype":"command","commandType":"auto","position":8.0,"command":"%sql\nSELECT * FROM People10M","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4ca9c2e0-c225-440b-a3ba-24d3feba626c"},{"version":"CommandV1","origId":1745794912681821,"guid":"a5ee94c3-c404-4714-898d-8a6732cf89a3","subtype":"command","commandType":"auto","position":9.0,"command":"%md\nTake a look at its schema with the `DESCRIBE` function.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"aac31cc3-7a1d-4bff-9b36-9082a4de10ea"},{"version":"CommandV1","origId":1745794912681822,"guid":"0ad3a902-e36f-4581-ba3b-7ef4b28420ac","subtype":"command","commandType":"auto","position":10.0,"command":"%sql\nDESCRIBE People10M","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2bda807e-ee8a-45b8-8b9e-f6d4bd4ab345"},{"version":"CommandV1","origId":1745794912681823,"guid":"6449adaf-e7ce-4efe-8788-46ff66d177f4","subtype":"command","commandType":"auto","position":11.0,"command":"%md\nA simple SQL statement can answer the following question:\n> According to our data, which women were born after 1990?\n\nIn Databricks, a `SELECT` statement in a SQL cell is automatically run through Spark, and the results are displayed in an HTML table.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fc92cf45-faa8-4071-8be8-b072c53213bf"},{"version":"CommandV1","origId":1745794912681824,"guid":"f80881a4-eabe-45a6-aa97-ab7bfc3730a7","subtype":"command","commandType":"auto","position":12.0,"command":"%sql\nSELECT firstName, middleName, lastName, birthDate\nFROM People10M\nWHERE year(birthDate) > 1990 AND gender = 'F'","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6348ec05-fb16-4a4b-861a-115f61550404"},{"version":"CommandV1","origId":1745794912681825,"guid":"71e10d53-5c5e-4485-ad1d-e3a4e40f619b","subtype":"command","commandType":"auto","position":13.0,"command":"%md\n### Built-in functions\n\nSpark provides a number of <a href=\"https://spark.apache.org/docs/latest/api/python/pyspark.sql.html#module-pyspark.sql.functions\" target=\"_blank\">built-in functions</a>, many of which can be used directly from SQL.  These functions can be used in the `WHERE` expressions to filter data and in `SELECT` expressions to create derived columns.\n\nThe following SQL statement finds women born after 1990; it uses the `year` function, and it creates a `birthYear` column on the fly.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f9ee052f-804b-4603-b0d4-70f09d9eb8e9"},{"version":"CommandV1","origId":1745794912681826,"guid":"7057412b-bc2f-4a59-bd59-ec7fba3ea575","subtype":"command","commandType":"auto","position":15.0,"command":"%sql\nSELECT firstName, middleName, lastName, year(birthDate) as birthYear, salary \nFROM People10M\nWHERE year(birthDate) > 1990 AND gender = 'F'","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f11b5a79-0544-4cb5-9190-443b27d5b9b1"},{"version":"CommandV1","origId":1745794912681827,"guid":"d115b054-1fc9-45c2-a196-65f23143df4c","subtype":"command","commandType":"auto","position":16.0,"command":"%md-sandbox\n### Visualization\n\nDatabricks provides built-in easy to use visualizations for your data. \n\nTake the query below, and visualize it by selecting the bar graph icon once the table is displayed:\n\n<img src=\"https://files.training.databricks.com/images/eLearning/visualization-1.png\" style=\"border: 1px solid #aaa; padding: 10px; border-radius: 10px 10px 10px 10px\"/>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b8b81ad7-5049-4ea8-b40f-7654f6680fe9"},{"version":"CommandV1","origId":1745794912681828,"guid":"20e32e85-531e-415d-b624-efbf17018157","subtype":"command","commandType":"auto","position":18.0,"command":"%md\nHow many women were named Mary in seach year?","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8cb5c8e1-df5d-42d2-8477-9775b781a539"},{"version":"CommandV1","origId":1745794912681829,"guid":"c3cd0da1-4473-42e9-a6a1-45075be46a4f","subtype":"command","commandType":"auto","position":19.0,"command":"%sql\nSELECT year(birthDate) as birthYear, count(*) AS total\nFROM People10M\nWHERE firstName = 'Mary' AND gender = 'F'\nGROUP BY birthYear\nORDER BY birthYear","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8d8337b4-9f0d-4695-a6c8-5b4f155ec591"},{"version":"CommandV1","origId":1745794912681830,"guid":"f6fd2e62-8458-4c51-b7d7-e3ebd08d349b","subtype":"command","commandType":"auto","position":20.0,"command":"%md\nCompare popularity of two names from 1990","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ea181d80-0b71-47ff-908f-438abcc7096e"},{"version":"CommandV1","origId":1745794912681831,"guid":"f1877912-564e-4c37-8405-62e761dfa648","subtype":"command","commandType":"auto","position":21.0,"command":"%sql\nSELECT year(birthDate) as birthYear,  firstName, count(*) AS total\nFROM People10M\nWHERE (firstName = 'Dorothy' or firstName = 'Donna') AND gender = 'F' AND year(birthDate) > 1990\nGROUP BY birthYear, firstName","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"98ec55bb-37bb-4a83-bf56-3bd4e15c6fe9"},{"version":"CommandV1","origId":1745794912681832,"guid":"5bc65d26-e3f6-48f4-b0e6-21c4d1c1e350","subtype":"command","commandType":"auto","position":22.0,"command":"%md\n### Temporary Views\n\nTemporary views assign a name to a query that will be reused as if they were tables themselves. Unlike tables, temporary views aren't stored on disk and are visible only to the current user. This course makes use of temporary views in the exercises to enable the test cases to verify your queries are correct.\n\nA temporary view gives you a name to query from SQL, but unlike a table, it exists only for the duration of your Spark Session. As a result, the temporary view will not carry over when you restart the cluster or switch to a new notebook. It also won't show up in the Data tab that, linked on the left of a Databricks notebook, provides easy access to databases and tables.\n\nThe following statement creates a temporary view containing the same data.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5e8b55db-cfbd-4a2d-bac4-021e155c8f34"},{"version":"CommandV1","origId":1745794912681833,"guid":"91a14e5d-d31f-4e88-a24e-50b96ade46d9","subtype":"command","commandType":"auto","position":24.0,"command":"%sql\nCREATE OR REPLACE TEMPORARY VIEW TheDonnas AS\n  SELECT * \n  FROM People10M \n  WHERE firstName = 'Donna'","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bcf6afd5-3d2d-4dd3-b862-158eda9b9cee"},{"version":"CommandV1","origId":1745794912681834,"guid":"be8c96a8-1da3-43b0-858c-d1f2f49b0aeb","subtype":"command","commandType":"auto","position":25.0,"command":"%md\nTo view the contents of temporary view, use select notation","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8a7a5515-38d5-4b72-aaa6-91f2d344364d"},{"version":"CommandV1","origId":1745794912681835,"guid":"01518372-a118-498d-bc09-a6eb08d858e1","subtype":"command","commandType":"auto","position":26.0,"command":"%sql\nSELECT * FROM TheDonnas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dbed7dba-d7d3-4048-8eda-e8a298707a64"},{"version":"CommandV1","origId":1745794912681836,"guid":"357eb592-888c-4095-a50a-bc68c1fdd7fb","subtype":"command","commandType":"auto","position":27.0,"command":"%md\nCreate more complex query from People10M table","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a85e2544-b077-4dfe-8dcf-8feaa85050ea"},{"version":"CommandV1","origId":1745794912681837,"guid":"d02cdaff-be3a-4503-affe-4d0972e48534","subtype":"command","commandType":"auto","position":28.0,"command":"%sql\nCREATE OR REPLACE TEMPORARY VIEW WomenBornAfter1990 AS\n  SELECT firstName, middleName, lastName, year(birthDate) AS birthYear, salary \n  FROM People10M\n  WHERE year(birthDate) > 1990 AND gender = 'F'","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a950ae18-7c32-4c1b-a423-7b1b3d252afa"},{"version":"CommandV1","origId":1745794912681838,"guid":"786fd59b-6d7b-4020-8337-8c2ec1297fd8","subtype":"command","commandType":"auto","position":29.0,"command":"%md\nOnce a temporary view has been created, it can be queried as if it were itself a table. Find out how many Marys are in the WomenBornAfter1990 view.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cd8a20bd-c46f-49ba-941e-0ec836039329"},{"version":"CommandV1","origId":1745794912681839,"guid":"d9efbf99-9458-42b8-897a-a4b613243677","subtype":"command","commandType":"auto","position":30.0,"command":"%sql\nSELECT birthYear, count(*) \nFROM WomenBornAfter1990 \nWHERE firstName = 'Mary' \nGROUP BY birthYear \nORDER BY birthYear","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8191e0e1-d0f7-4a40-935a-59d7083d1422"},{"version":"CommandV1","origId":1745794912681840,"guid":"8043962c-4122-496c-9a16-73e2c66be01e","subtype":"command","commandType":"auto","position":31.0,"command":"%md-sandbox\n## Exercise 1\n\nCreate a temporary view called `Top10FemaleFirstNames` that contains the 10 most common female first names in the `People10M` table. The view must have two columns:\n\n* `firstName` - the first name\n* `total` - the total number of rows with that first name\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** You may need to break ties by firstName because some of the totals are identical\n\nDisplay the results.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5d58e3d2-9e15-44f9-8990-6439ed433939"},{"version":"CommandV1","origId":1745794912681841,"guid":"e12c431f-c990-4e23-9b09-1ca4c15e4508","subtype":"command","commandType":"auto","position":32.0,"command":"%md\n### Step 1\nCreate the temporary view.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"17096783-f23d-4fa8-bd20-393908e55cf9"},{"version":"CommandV1","origId":1745794912681842,"guid":"63973593-1bd2-473e-aec9-6ec29a2b4402","subtype":"command","commandType":"auto","position":33.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW Top10FemaleFirstNames AS\n  SELECT firstName, COUNT(firstName) AS total\n  FROM People10M\n  WHERE gender = 'F'\n  GROUP BY firstName\n  ORDER BY total DESC, firstName\n  LIMIT 10","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fb3a70b8-aa91-463f-a1aa-ee5de7a66161"},{"version":"CommandV1","origId":1745794912681843,"guid":"80c63f80-0af7-43b6-bf7d-94de55efa4d7","subtype":"command","commandType":"auto","position":34.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nresultsDF = spark.sql(\"SELECT * FROM Top10FemaleFirstNames ORDER BY firstName\")\ndbTest(\"SQL-L2-count\", 10, resultsDF.count())\n\nresults = [ (r[0]+\", \"+str(r[1]) ) for r in resultsDF.collect()]\ndbTest(\"SQL-L2-names-0\", \"Alesha, 1368\", results[0])\ndbTest(\"SQL-L2-names-1\", \"Alice, 1384\", results[1])\ndbTest(\"SQL-L2-names-2\", \"Bridgette, 1373\", results[2])\ndbTest(\"SQL-L2-names-3\", \"Cristen, 1375\", results[3])\ndbTest(\"SQL-L2-names-4\", \"Jacquelyn, 1381\", results[4])\ndbTest(\"SQL-L2-names-5\", \"Katherin, 1373\", results[5])\ndbTest(\"SQL-L2-names-6\", \"Lashell, 1387\", results[6])\ndbTest(\"SQL-L2-names-7\", \"Louie, 1382\", results[7])\ndbTest(\"SQL-L2-names-8\", \"Lucille, 1384\", results[8])\ndbTest(\"SQL-L2-names-9\", \"Sharyn, 1394\", results[9])\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"28e777c8-1024-4b52-8aef-01ca0f81315d"},{"version":"CommandV1","origId":1745794912681844,"guid":"f10887c6-bbf0-47f0-ab04-23537e6f9c5a","subtype":"command","commandType":"auto","position":35.0,"command":"%md\n### Step 2\n\nDisplay the contents of the temporary view.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e7699486-0269-4a8c-a514-15e3fc605356"},{"version":"CommandV1","origId":1745794912681845,"guid":"214ff4a0-90da-48b5-a829-6db69e6630cc","subtype":"command","commandType":"auto","position":36.0,"command":"%sql\n-- ANSWER\n\nSELECT * FROM Top10FemaleFirstNames","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e600a993-1d00-4441-937d-2976a59e2c38"},{"version":"CommandV1","origId":1745794912681846,"guid":"bdd2d823-23ae-4c11-a21c-4c5a56d1e56d","subtype":"command","commandType":"auto","position":37.0,"command":"%md\n## Summary\n* Spark SQL queries tables that are backed by physical files\n* You can visualize the results of your queries with built-in Databricks graphs","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b0fa150f-8cbe-4c05-a827-a769557f8119"},{"version":"CommandV1","origId":1745794912681847,"guid":"03e0f0fd-ba91-41ac-a15a-f740b0150ac2","subtype":"command","commandType":"auto","position":38.0,"command":"%md\n## Review Questions\n**Q:** What is the prefix used in databricks cells to execute SQL queries?  \n**A:** `%sql`\n\n**Q:** How do temporary views differ from tables?  \n**A:** Tables are visible to all users, can be accessed from any notebook, and persist across server resets.  Temporary views are only visible to the current user, in the current notebook, and are gone once the spark session ends.\n\n**Q:** What is the SQL syntax to create a temporary view?  \n**A:** ```CREATE OR REPLACE TEMPORARY VIEW <<ViewName>> AS <<Query>>```","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ba73cea8-5988-45ac-8fcc-b502c3967cb3"},{"version":"CommandV1","origId":1745794912681848,"guid":"44845425-4ccd-4b06-8872-ce4e036c8ae8","subtype":"command","commandType":"auto","position":39.0,"command":"%md\n## Next Steps\n\nStart the next lesson, [Exploratory Data Analysis]($./02S-Exploratory-Data-Analysis).","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f76667b7-b2e4-4f7c-81d5-059ec6e43c5a"},{"version":"CommandV1","origId":1745794912681849,"guid":"75ea0103-8758-420a-b2c9-8019232c5f44","subtype":"command","commandType":"auto","position":40.0,"command":"%md\n## Additional Topics & Resources\n\n* <a href=\"https://docs.databricks.com/spark/latest/spark-sql/index.html\" target=\"_blank\">Spark SQL Reference</a>\n* <a href=\"http://spark.apache.org/docs/latest/sql-programming-guide.html\" target=\"_blank\">Spark SQL, DataFrames and Datasets Guide</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"475151a6-6fb9-481e-838c-f586e0411e5d"}],"dashboards":[],"guid":"becfa4f2-7d20-4194-afbe-fbb67ae695d6","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}