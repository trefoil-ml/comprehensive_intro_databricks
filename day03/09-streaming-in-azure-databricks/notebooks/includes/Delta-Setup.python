{"version":"NotebookV1","origId":1745794912682706,"name":"Delta-Setup","language":"python","commands":[{"version":"CommandV1","origId":1745794912682707,"guid":"03684c41-5ea6-4876-8c50-3b0d29edb73a","subtype":"command","commandType":"auto","position":1.0,"command":"%python\nspark.sql(\"set spark.databricks.delta.preview.enabled=true\")\nspark.sql(\"set spark.databricks.delta.retentionDurationCheck.enabled=false\")\nNone # suppress output","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b9fd89ed-ee32-4287-95ed-a3757ca3843a"},{"version":"CommandV1","origId":1745794912682708,"guid":"9816d397-ecb9-418c-82b4-aef95627e959","subtype":"command","commandType":"auto","position":2.0,"command":"def removeFolderContents(folder):\n  for fileInfo in dbutils.fs.ls(folder):\n    dbutils.fs.rm(fileInfo.path, true)\nNone","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"318f05f5-d624-4a04-b241-448c4bb88dc4"},{"version":"CommandV1","origId":1745794912682709,"guid":"def36e51-b4d6-47da-8431-fdf3c72eb712","subtype":"command","commandType":"auto","position":3.0,"command":"def stopStreamAfterTime(streamingQuery, hours=0.0, minutes=0.0, seconds=0.0):\n  \"\"\"\n    Stops a streaming query after the specified number of minutes.\n    This helps to avoid unintentionally leaving the streaming job running overnight.\n    If time<=0, the default is 30 minutes.\n  \"\"\"\n  from threading import Timer\n  seconds=(hours*60.0+minutes)*60.0+seconds\n  if (seconds < 0.000001):\n    seconds=30*60 #default to 30 minutes\n  timer=Timer(seconds, streamingQuery.stop)\n  timer.start()\nNone","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4c934d05-53c7-4140-aad7-c0bfd5acf04f"},{"version":"CommandV1","origId":1745794912682710,"guid":"2dd08359-f1fe-4cfd-9a49-45ebfc20e5f9","subtype":"command","commandType":"auto","position":4.0,"command":"def stopAllStreamsAfterTime(hours=0.0, minutes=0.0, seconds=0.0):\n  \"\"\"\n    Stops all streaming querying in this notebook after the specified number of hours.\n    This helps to avoid unintentionally leaving the streaming job running overnight.\n    If time<=0, the default is 2 hours.\n  \"\"\"\n  from threading import Timer\n  def stopAllStreams():\n    for streamingQuery in spark.streams.active:\n      streamingQuery.stop()\n  try:\n    if topAllStreamsAfterTime.timer.is_alive():\n      stopAllStreamsAfterTime.timer.cancel()\n  except:\n    pass\n  seconds=(hours*60.0+minutes)*60.0+seconds\n  if (seconds < 0.000001):\n    seconds=2*60*60 #default to 2 hours\n  stopAllStreamsAfterTime.timer=Timer(seconds, stopAllStreams)\n  stopAllStreamsAfterTime.timer.start()\n\nstopAllStreamsAfterTime()\n\nNone","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"58b2de2b-99e5-4d07-9c1a-2c2016760339"}],"dashboards":[],"guid":"03a22f1a-9c0d-4582-bbde-bfa82c1dc32b","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}