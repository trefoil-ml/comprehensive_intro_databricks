{"version":"NotebookV1","origId":1745794912675499,"name":"03-Joins-Aggregations","language":"scala","commands":[{"version":"CommandV1","origId":1745794912675500,"guid":"badf19f0-7d20-42f0-95f9-13b5f14def19","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Challenge Exercises","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"53a63d09-9d40-43cf-90f6-cccda136ba8e"},{"version":"CommandV1","origId":1745794912675501,"guid":"cbe779bd-e948-4a60-9333-9d2cce106dcc","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n### Getting Started\n\nRun the following cell to configure our \"classroom\".","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"52b43295-04e8-4377-a8ee-1b33bbd735b1"},{"version":"CommandV1","origId":1745794912675502,"guid":"c0b37832-3618-4612-abf1-3f25337f7932","subtype":"command","commandType":"auto","position":4.0,"command":"%run \"../Includes/Classroom-Setup\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bbfae345-0d43-4def-9631-87f8023ebcca"},{"version":"CommandV1","origId":1745794912675503,"guid":"3d6baeb5-c66d-4e7e-9261-aeeab36f022d","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n## Challenge Exercise 3\n\nStarting with the `/mnt/training/ssn/names-1880-2016.parquet/` file, find the most popular first name for girls in 1885, 1915, 1945, 1975, and 2005.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4a9ebf58-9fc0-452d-89a1-82e10c32cb71"},{"version":"CommandV1","origId":1745794912675504,"guid":"abf205db-7c2c-41f2-8b3b-c7e6186c76b2","subtype":"command","commandType":"auto","position":6.0,"command":"%md-sandbox\n### Step 1\nCreate a temporary view called `HistoricNames` where:\n0. You may need to create temporary DataFrames to generate the DataFrame listing the names.\n0. The result has three columns:\n  * `firstName`\n  * `year`\n  * `total`\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** This is an example of a nested `SELECT` if you were to use SQL syntax. Using DataFrames, you will need to craft two queries and perform a `join`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3ad08dad-074f-452d-9ff2-1bc7354a35cd"},{"version":"CommandV1","origId":1745794912675505,"guid":"5ee136cf-cf1b-4970-8d54-70c743b17e3c","subtype":"command","commandType":"auto","position":7.0,"command":"%md\n### Step 1\n\nLoad `/mnt/training/ssn/names-1880-2016.parquet` into a DataFrame called `ssaDF` and display the schema.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bfc490e6-4fa7-4681-988a-e819608f98f3"},{"version":"CommandV1","origId":1745794912675506,"guid":"4054e50c-a5df-4f32-b1c7-fc82bb626615","subtype":"command","commandType":"auto","position":8.0,"command":"// TODO\n\nval ssaDF = // FILL_IN\n\nssaDF.printSchema()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"03ada1d1-4c61-471d-9f89-b2ccc91e9192"},{"version":"CommandV1","origId":1745794912675507,"guid":"e0930c5c-bcfb-458a-8b4e-4edf580c0845","subtype":"command","commandType":"auto","position":9.0,"command":"%md\n### Step 2\n\nCraft a DataFrame query that solves the problem described above.\n\nDisplay the output of the DataFrame.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"07e9de9b-9107-4953-b1d4-aa81b3350375"},{"version":"CommandV1","origId":1745794912675508,"guid":"9f89ad97-fee6-4b4e-92e8-043ef76c32c7","subtype":"command","commandType":"auto","position":10.0,"command":"// TODO\n\nimport org.apache.spark.sql.functions.max\nval maxNamesDF = // FILL_IN\nval outerQueryDF = // FILL_IN\nval joinedQueryDF = // FILL_IN\n\njoinedQueryDF.show()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"60171c88-bd6f-4061-8a5e-eba4f715055b"},{"version":"CommandV1","origId":1745794912675509,"guid":"43e75bef-7d51-4d0e-af21-a3c0a789234b","subtype":"command","commandType":"auto","position":11.0,"command":"// TEST - Run this cell to test your solution.\n\nlazy val results = joinedQueryDF.select(\"firstName\", \"year\", \"total\").collect()\n\ndbTest(\"DF-L3-Opt-historicNames-0\", Row(\"Mary\", 1885, 9128), results(0))\ndbTest(\"DF-L3-Opt-historicNames-1\", Row(\"Mary\", 1915, 58187), results(1))\ndbTest(\"DF-L3-Opt-historicNames-2\", Row(\"Mary\", 1945, 59288), results(2))\ndbTest(\"DF-L3-Opt-historicNames-3\", Row(\"Jennifer\", 1975, 58186), results(3))\ndbTest(\"DF-L3-Opt-historicNames-4\", Row(\"Emily\", 2005, 23934), results(4))","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f5aec235-18be-47f1-9ba3-80cc629743e9"}],"dashboards":[],"guid":"51223219-5d37-48db-9d9c-5cc99a3d48f3","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}