{"version":"NotebookV1","origId":1745794912676990,"name":"03-Joins-Aggregations","language":"python","commands":[{"version":"CommandV1","origId":1745794912676991,"guid":"06b70abb-74fc-4738-86a6-72186ce7fec5","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Challenge Exercises","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"889bc4e4-ccb1-4081-9c0c-868f4b4796ad"},{"version":"CommandV1","origId":1745794912676992,"guid":"5107a3ac-1119-4fad-85b3-b5d79d8e2bf1","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n### Getting Started\n\nRun the following cell to configure our \"classroom\".","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"17c8d1ee-5867-49d4-9593-76a7293d8b79"},{"version":"CommandV1","origId":1745794912676993,"guid":"d3e45ade-046a-4fb7-846f-0f754fd611bf","subtype":"command","commandType":"auto","position":4.0,"command":"%run \"../Includes/Classroom-Setup\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9dc7eabb-3d61-46ec-a9a0-654e4b1c3ae3"},{"version":"CommandV1","origId":1745794912676994,"guid":"37234023-7aa7-4b01-92dd-e25df716d34a","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n## Challenge Exercise 3\n\nStarting with the `/mnt/training/ssn/names-1880-2016.parquet/` file, find the most popular first name for girls in 1885, 1915, 1945, 1975, and 2005.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a1bb0e34-10ac-4cc3-a8cb-f5b6d1e2213e"},{"version":"CommandV1","origId":1745794912676995,"guid":"61a78286-480b-473f-b12b-5c9c59c260c3","subtype":"command","commandType":"auto","position":6.0,"command":"%md-sandbox\n### Step 1\nCreate a temporary view called `HistoricNames` where:\n0. You may need to create temporary DataFrames to generate the DataFrame listing the names.\n0. The result has three columns:\n  * `firstName`\n  * `year`\n  * `total`\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** This is an example of a nested `SELECT` if you were to use SQL syntax. Using DataFrames, you will need to craft two queries and perform a `join`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"472cd8f2-bb70-4902-8a08-c3c14b526647"},{"version":"CommandV1","origId":1745794912676996,"guid":"f32f8a6b-2e24-4851-b4d8-055ea1cb360a","subtype":"command","commandType":"auto","position":7.0,"command":"%md\n### Step 1\n\nLoad `/mnt/training/ssn/names-1880-2016.parquet` into a DataFrame called `ssaDF` and display the schema.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b9b6b2e5-adc7-47b5-ac5b-9d7134fd0020"},{"version":"CommandV1","origId":1745794912676997,"guid":"4bbbaa61-bacd-47f2-90de-cb2eff4a7872","subtype":"command","commandType":"auto","position":8.0,"command":"# TODO\n\nssaDF = # FILL_IN\n\nssaDF.printSchema()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6223ef8a-0eca-4b1d-b7f6-b0863a5f04d6"},{"version":"CommandV1","origId":1745794912676998,"guid":"4950c0ad-2db4-42d7-96f1-7f8f486b4633","subtype":"command","commandType":"auto","position":9.0,"command":"%md\n### Step 2\n\nCraft a DataFrame query that solves the problem described above.\n\nDisplay the output of the DataFrame.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bb1da3e9-e32f-4bbd-a54a-77690095a5e2"},{"version":"CommandV1","origId":1745794912676999,"guid":"3effd848-4521-47f7-ae84-9d65702bb14b","subtype":"command","commandType":"auto","position":10.0,"command":"# TODO\n\nfrom pyspark.sql.functions import col, max\nmaxNamesDF = # FILL_IN\nouterQueryDF = # FILL_IN\njoinedQueryDF = # FILL_IN\n\njoinedQueryDF.show()","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"33785c71-26a7-46dd-998d-501a0f896ceb"},{"version":"CommandV1","origId":1745794912677000,"guid":"97708e29-6105-4f94-811a-db5e770b3365","subtype":"command","commandType":"auto","position":11.0,"command":"# TEST - Run this cell to test your solution.\n\nresultsDF = joinedQueryDF.select(\"firstName\", \"year\", \"total\")\nresults = [ (r[0]+\" \"+str(r[1])+\": \"+str(r[2])) for r in resultsDF.collect()]\n\ndbTest(\"DF-L3-Opt-historicNames-0\", u'Mary 1885: 9128', results[0])\ndbTest(\"DF-L3-Opt-historicNames-1\", u'Mary 1915: 58187', results[1])\ndbTest(\"DF-L3-Opt-historicNames-2\", u'Mary 1945: 59288', results[2])\ndbTest(\"DF-L3-Opt-historicNames-3\", u'Jennifer 1975: 58186', results[3])\ndbTest(\"DF-L3-Opt-historicNames-4\", u'Emily 2005: 23934', results[4])","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ab25c7b2-009c-4a46-b2c6-2dfd594feb36"}],"dashboards":[],"guid":"b2670383-8062-4aba-a4cd-f2790ef9af88","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}