{"version":"NotebookV1","origId":1745794912675988,"name":"05S-Querying-JSON","language":"python","commands":[{"version":"CommandV1","origId":1745794912675989,"guid":"63d4b039-4f35-40ce-95ce-1ad69847f508","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Querying JSON & Hierarchical Data with DataFrames\n\nApache Spark&trade; and Azure Databricks&reg; make it easy to work with hierarchical data, such as nested JSON records.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a41517b0-e472-4d83-9198-c7feeead6f80"},{"version":"CommandV1","origId":1745794912675990,"guid":"6dac5b38-353d-4e1c-ac2c-b537e3c99823","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n### Getting Started\n\nRun the following cell to configure our \"classroom.\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"07084464-bdc7-4313-88b1-400342204342"},{"version":"CommandV1","origId":1745794912675991,"guid":"f8d03f5c-2c31-44b3-a83d-c0541349b27d","subtype":"command","commandType":"auto","position":4.0,"command":"%run \"./Includes/Classroom-Setup\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f18d4730-88bd-4c10-81c8-0a56fed9a7a3"},{"version":"CommandV1","origId":1745794912675992,"guid":"9e0cfa8f-dd71-4d29-8548-e4125fbab3fc","subtype":"command","commandType":"auto","position":6.0,"command":"%md\n## Examining the contents of a JSON file\n\nJSON is a common file format in big data applications and in data lakes (or large stores of diverse data).  Datatypes such as JSON arise out of a number of data needs.  For instance, what if...  \n<br>\n* Your schema, or the structure of your data, changes over time?\n* You need nested fields like an array with many values or an array of arrays?\n* You don't know how you're going use your data yet so you don't want to spend time creating relational tables?\n\nThe popularity of JSON is largely due to the fact that JSON allows for nested, flexible schemas.\n\nThis lesson uses the `DatabricksBlog` table, which is backed by JSON file `dbfs:/mnt/training/databricks-blog.json`. If you examine the raw file, you can see that it contains compact JSON data. There's a single JSON object on each line of the file; each object corresponds to a row in the table. Each row represents a blog post on the <a href=\"https://databricks.com/blog\" target=\"_blank\">Databricks blog</a>, and the table contains all blog posts through August 9, 2017.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"93df8771-88bd-40b2-a5be-f437a6721559"},{"version":"CommandV1","origId":1745794912675993,"guid":"859cb088-b76b-48de-9201-a19f5592c198","subtype":"command","commandType":"auto","position":8.0,"command":"%fs head dbfs:/mnt/training/databricks-blog.json","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9dadae03-a856-4d11-b991-8cb51891cf4d"},{"version":"CommandV1","origId":1745794912675994,"guid":"f07a602c-20de-4c9b-ba01-932a2d9add78","subtype":"command","commandType":"auto","position":9.0,"command":"%md\nTo expose the JSON file as a table, use the standard SQL create table using syntax introduced in the previous lesson:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"10ab641a-85cf-4d3c-8b48-2c5ccb434dc5"},{"version":"CommandV1","origId":1745794912675995,"guid":"f93d1276-9fd2-4e9b-85b9-1cb138b4324e","subtype":"command","commandType":"auto","position":10.0,"command":"%sql\nCREATE TABLE IF NOT EXISTS DatabricksBlog\n  USING json\n  OPTIONS (\n    path \"dbfs:/mnt/training/databricks-blog.json\",\n    inferSchema \"true\"\n  )","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"94140863-54a9-4bc4-8b45-9812d119f2c2"},{"version":"CommandV1","origId":1745794912675996,"guid":"ebf03f9a-a09e-448d-973c-52302fc63810","subtype":"command","commandType":"auto","position":11.0,"command":"%md\nTake a look at the schema with the `DESCRIBE` function.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5397c1ff-0f56-4745-b593-37083f159cf8"},{"version":"CommandV1","origId":1745794912675997,"guid":"d1722da1-ddc6-4726-b84d-68607e8f179f","subtype":"command","commandType":"auto","position":12.0,"command":"%sql\nDESCRIBE DatabricksBlog","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3129f573-ee79-4db2-9cd7-9d0e544ef6f6"},{"version":"CommandV1","origId":1745794912675998,"guid":"40f3a36a-c4ec-4691-8b7a-646aab92fc40","subtype":"command","commandType":"auto","position":13.0,"command":"%md\nRun a query to view the contents of the table.\n\nNotice:\n* The `authors` column is an array containing multiple author names.\n* The `categories` column is an array of multiple blog post category names.\n* The `dates` column contains nested fields `createdOn`, `publishedOn` and `tz`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a0bd5028-d855-49e1-aa26-492c1cd6b655"},{"version":"CommandV1","origId":1745794912675999,"guid":"7beb78a5-e21c-4143-b854-983cc41831f4","subtype":"command","commandType":"auto","position":14.0,"command":"%sql\nSELECT authors, categories, dates, content \nFROM DatabricksBlog","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f356adc9-7ef5-4443-bf85-447329061cd6"},{"version":"CommandV1","origId":1745794912676000,"guid":"4bd791b7-316a-4010-9301-69e4c7675149","subtype":"command","commandType":"auto","position":15.0,"command":"%md\n## Nested Data\n\nThink of nested data as columns within columns. \n\nFor instance, look at the `dates` column.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"23abd8ef-c8cc-4634-9c17-00f21a5685e0"},{"version":"CommandV1","origId":1745794912676001,"guid":"74ba191d-005a-409e-8694-f90592643044","subtype":"command","commandType":"auto","position":17.0,"command":"%sql\nSELECT dates FROM DatabricksBlog","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3d6af7d4-2310-45b0-a34e-7439d1b8c673"},{"version":"CommandV1","origId":1745794912676002,"guid":"e60922d1-2557-459d-b6b8-10dfd3c03db7","subtype":"command","commandType":"auto","position":18.0,"command":"%md\nPull out a specific subfield with \"dot\" notation.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"929176e2-e955-4f5d-8806-0ffba05989c7"},{"version":"CommandV1","origId":1745794912676003,"guid":"855f7753-2dfb-41f0-8d34-1d71688f8c1e","subtype":"command","commandType":"auto","position":19.0,"command":"%sql\nSELECT dates.createdOn, dates.publishedOn \nFROM DatabricksBlog","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"734f6624-a364-461b-80e8-4b958dc5a803"},{"version":"CommandV1","origId":1745794912676004,"guid":"79f15717-0e83-464d-970c-6892f31edcfa","subtype":"command","commandType":"auto","position":20.0,"command":"%md\nBoth `createdOn` and `publishedOn` are stored as strings.\n\nCast those values to SQL timestamps:\n\nIn this case, use a single `SELECT` statement to:\n0. Cast `dates.publishedOn` to a `timestamp` data type.\n0. \"Flatten\" the `dates.publishedOn` column to just `publishedOn`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"93b3e2e1-e789-4eb3-9c07-f1b7975df3f3"},{"version":"CommandV1","origId":1745794912676005,"guid":"4b619276-67f9-434f-9e34-e88652668696","subtype":"command","commandType":"auto","position":21.0,"command":"%sql\nSELECT title, \n       cast(dates.publishedOn AS timestamp) AS publishedOn \nFROM DatabricksBlog","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"05f653f3-44ca-4865-b3f2-c6b3da431d53"},{"version":"CommandV1","origId":1745794912676006,"guid":"975bf0d7-6660-4d32-94d5-c10645996e4e","subtype":"command","commandType":"auto","position":22.0,"command":"%md\nCreate the temporary view `DatabricksBlog2` to capture the conversion and flattening of the `publishedOn` column.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0e6cd499-d8ac-4685-a607-b65b540b8598"},{"version":"CommandV1","origId":1745794912676007,"guid":"4007772e-3025-4a47-ba40-e15f6146d469","subtype":"command","commandType":"auto","position":23.0,"command":"%sql\nCREATE OR REPLACE TEMPORARY VIEW DatabricksBlog2 AS\n  SELECT *, \n         cast(dates.publishedOn AS timestamp) AS publishedOn \n  FROM DatabricksBlog","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ea897e8b-9017-4533-b66e-26d98c31ac72"},{"version":"CommandV1","origId":1745794912676008,"guid":"4c900b19-baa6-4936-b2e3-16e277454065","subtype":"command","commandType":"auto","position":24.0,"command":"%md\nNow that we have this temporary view, we can use `DESCRIBE` to check its schema and confirm the timestamp conversion.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"89ec0d59-2932-4022-b9ca-70dfd7e2a0bb"},{"version":"CommandV1","origId":1745794912676009,"guid":"e8544cb3-0f28-404d-b394-ed4e49ff7d4f","subtype":"command","commandType":"auto","position":25.0,"command":"%sql\nDESCRIBE DatabricksBlog2","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0641a101-d0d3-4628-bdda-188e9c03e947"},{"version":"CommandV1","origId":1745794912676010,"guid":"86190787-e508-49f9-996b-d744f30a54e5","subtype":"command","commandType":"auto","position":26.0,"command":"%md-sandbox\nNow the dates are represented by a `timestamp` data type, query for articles within certain date ranges (such as getting a list of all articles published in 2013), and format the date for presentation purposes.\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> See the Spark documentation, <a href=\"https://spark.apache.org/docs/latest/api/python/pyspark.sql.html#module-pyspark.sql.functions\" target=\"_blank\">built-in functions</a>, for a long list of date-specific functions.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"57582d31-2fd1-46ba-bd52-004de92f6ca0"},{"version":"CommandV1","origId":1745794912676011,"guid":"10157cf1-265e-45c5-87c0-8327f945fe77","subtype":"command","commandType":"auto","position":27.0,"command":"%sql\nSELECT title, \n       date_format(publishedOn, \"MMM dd, yyyy\") AS date, \n       link \nFROM DatabricksBlog2\nWHERE year(publishedOn) = 2013\nORDER BY publishedOn","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"33546b9c-6327-44ba-a83e-ea1d19ff71e7"},{"version":"CommandV1","origId":1745794912676012,"guid":"59c43a9c-7977-4d4f-9085-a3c33a703ea5","subtype":"command","commandType":"auto","position":28.0,"command":"%md\n## Array Data\n\nThe table also contains array columns. \n\nEasily determine the size of each array using the built-in `size(..)` function with array columns.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"fca4031c-107d-4753-a603-07ff836eabbe"},{"version":"CommandV1","origId":1745794912676013,"guid":"dd9facb4-36c7-4c1e-91c2-7f8b1b7db8c3","subtype":"command","commandType":"auto","position":30.0,"command":"%sql\nSELECT size(authors), \n       authors \nFROM DatabricksBlog","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d82abf54-a84f-4077-83e6-5cb5a5ddcd60"},{"version":"CommandV1","origId":1745794912676014,"guid":"032e2cbe-0149-4934-a3a4-8328c8c9c525","subtype":"command","commandType":"auto","position":31.0,"command":"%md\nPull the first element from the array `authors` using an array subscript operator.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d9607c48-fc39-4cc7-afcc-4e74651c2f44"},{"version":"CommandV1","origId":1745794912676015,"guid":"99ecbfd6-9e83-45d7-bfaa-09876f62d438","subtype":"command","commandType":"auto","position":32.0,"command":"%sql\nSELECT authors[0] AS primaryAuthor \nFROM DatabricksBlog","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"07a6973c-a3cc-489a-8275-2548c07fb9a9"},{"version":"CommandV1","origId":1745794912676016,"guid":"683ed030-4a15-4750-a52b-bad0b6108e7b","subtype":"command","commandType":"auto","position":33.0,"command":"%md\n### Explode\n\nThe `explode` function allows you to split an array column into multiple rows, copying all the other columns into each new row. \n\nFor example, you can split the column `authors` into the column `author`, with one author per row.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6a439d5f-d940-4ae7-a0c1-cb08bc7d31ce"},{"version":"CommandV1","origId":1745794912676017,"guid":"bea0707e-7747-4a80-bad8-9e46f0797994","subtype":"command","commandType":"auto","position":35.0,"command":"%sql\nSELECT title, \n       authors, \n       explode(authors) AS author, \n       link \nFROM DatabricksBlog","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"68408024-bd62-488b-8d0b-03cb1eb45f3c"},{"version":"CommandV1","origId":1745794912676018,"guid":"91fb3abc-df9f-42ee-a4a7-a6e2ef25e23f","subtype":"command","commandType":"auto","position":36.0,"command":"%md\nIt's more obvious to restrict the output to articles that have multiple authors, and sort by the title.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"becd7642-0d74-4931-bb46-2a92504921fe"},{"version":"CommandV1","origId":1745794912676019,"guid":"91056717-af01-4260-a873-52f0a0115579","subtype":"command","commandType":"auto","position":37.0,"command":"%sql\nSELECT title, \n       authors, \n       explode(authors) AS author, \n       link \nFROM DatabricksBlog \nWHERE size(authors) > 1 \nORDER BY title","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f312644f-9ff2-43ae-8997-a454849010ab"},{"version":"CommandV1","origId":1745794912676020,"guid":"49be9f39-c32d-4794-a352-99456b89772f","subtype":"command","commandType":"auto","position":38.0,"command":"%md\n### Lateral View\nThe data has multiple columns with nested objects.  In this case, the data has multiple dates, authors, and categories.\n\nTake a look at the blog entry **Apache Spark 1.1: The State of Spark Streaming**:","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c621c354-2ec0-4484-a9f3-98f24ded8ba0"},{"version":"CommandV1","origId":1745794912676021,"guid":"fb7940a3-17f7-469c-b117-24cbf4940001","subtype":"command","commandType":"auto","position":39.0,"command":"%sql\nSELECT dates.publishedOn, title, authors, categories\nFROM DatabricksBlog\nWHERE title = \"Apache Spark 1.1: The State of Spark Streaming\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ec8049af-e444-4e0e-b717-1e5327336b03"},{"version":"CommandV1","origId":1745794912676022,"guid":"6ed1f1b8-1a9b-4821-baee-08bb82fe2ca3","subtype":"command","commandType":"auto","position":40.0,"command":"%md\nNext, use `LATERAL VIEW` to explode multiple columns at once, in this case, the columns `authors` and `categories`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"1495f64f-de84-4281-802b-6ea524357932"},{"version":"CommandV1","origId":1745794912676023,"guid":"dafa020f-3445-4d8f-856e-46d5f39f686d","subtype":"command","commandType":"auto","position":41.0,"command":"%sql\nSELECT dates.publishedOn, title, author, category\nFROM DatabricksBlog\nLATERAL VIEW explode(authors) exploded_authors_view AS author\nLATERAL VIEW explode(categories) exploded_categories AS category\nWHERE title = \"Apache Spark 1.1: The State of Spark Streaming\"\nORDER BY author, category","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4a9d177d-373d-4fe4-bdff-ae78ae0f77d5"},{"version":"CommandV1","origId":1745794912676024,"guid":"9438ea97-dfe1-456c-8629-edbff09d0357","subtype":"command","commandType":"auto","position":42.0,"command":"%md\n## Exercise 1\n\nIdentify all the articles written or co-written by Michael Armbrust.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"51b43c84-1a4d-40d2-8dfa-4692dfe8d0e4"},{"version":"CommandV1","origId":1745794912676025,"guid":"1037b901-83f4-4b04-bcdc-ddcf800eab3e","subtype":"command","commandType":"auto","position":43.0,"command":"%md-sandbox\n### Step 1\n\nStarting with the table `DatabricksBlog`, create a temporary view called `ArticlesByMichael` where:\n0. Michael Armbrust is the author\n0. The data set contains the column `title` (it may contain others)\n0. It contains only one record per article\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** See the Spark documentation, <a href=\"https://spark.apache.org/docs/latest/api/python/pyspark.sql.html#module-pyspark.sql.functions\" target=\"_blank\">built-in functions</a>.  \n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** Include the column `authors` in your view, to help you debug your solution.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"01d3b33e-b97a-4804-9ecd-b2a3384aacb4"},{"version":"CommandV1","origId":1745794912676026,"guid":"9ab1db44-6577-4f98-9230-feb41f8c16ed","subtype":"command","commandType":"auto","position":44.0,"command":"%sql\n-- ANSWER\n\nDROP TABLE IF EXISTS ArticlesByMichael;\n\nCREATE OR REPLACE TEMPORARY VIEW ArticlesByMichael AS\n  SELECT title\n  FROM DatabricksBlog \n  WHERE array_contains(authors, 'Michael Armbrust')","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0e1769eb-f244-403e-8964-5c4ca1a20795"},{"version":"CommandV1","origId":1745794912676027,"guid":"d303b055-3463-4330-b587-018dd29df098","subtype":"command","commandType":"auto","position":45.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nresultsDF = spark.sql(\"select title from ArticlesByMichael order by title\")\ndbTest(\"SQL-L5-articlesByMichael-count\", 3, resultsDF.count())\n\nresults = [r[0] for r in resultsDF.collect()]\ndbTest(\"SQL-L5-articlesByMichael-0\", \"Exciting Performance Improvements on the Horizon for Spark SQL\", results[0])\ndbTest(\"SQL-L5-articlesByMichael-1\", \"Spark SQL Data Sources API: Unified Data Access for the Apache Spark Platform\", results[1])\ndbTest(\"SQL-L5-articlesByMichael-2\", \"Spark SQL: Manipulating Structured Data Using Apache Spark\", results[2])\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"d2bdce70-cabb-4b63-b1c2-17a40c089945"},{"version":"CommandV1","origId":1745794912676028,"guid":"57e37b63-3052-4034-a597-49ed9d146fea","subtype":"command","commandType":"auto","position":46.0,"command":"%md\n### Step 2\nShow the list of Michael Armbrust's articles.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f10a0e2f-b926-41cb-9c7c-3b27d6e28b72"},{"version":"CommandV1","origId":1745794912676029,"guid":"51438b14-43d1-4c2e-b373-399b0acb84db","subtype":"command","commandType":"auto","position":47.0,"command":"%sql\n-- ANSWER\n\nSELECT * FROM ArticlesByMichael","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f80e372b-5d24-406f-be4d-1a9181f62f43"},{"version":"CommandV1","origId":1745794912676030,"guid":"d347c689-8286-451b-bbcd-b9ab475ec306","subtype":"command","commandType":"auto","position":48.0,"command":"%md\n## Exercise 2\n\nIdentify the complete set of categories used in the Databricks blog articles.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c4551856-557c-4212-b25e-dbd81ce1c44a"},{"version":"CommandV1","origId":1745794912676031,"guid":"e0f6b1f0-f372-4f16-a4ce-a82c7dd492c3","subtype":"command","commandType":"auto","position":49.0,"command":"%md\n### Step 1\n\nStarting with the table `DatabricksBlog`, create another view called `UniqueCategories` where:\n0. The data set contains the one column `category` (and no others)\n0. This list of categories should be unique","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e5dc7864-91e0-4475-8343-7efaff62ddc7"},{"version":"CommandV1","origId":1745794912676032,"guid":"b3a8febf-34a6-4812-819d-2647c111116f","subtype":"command","commandType":"auto","position":50.0,"command":"%sql\n-- ANSWER\n\nDROP TABLE IF EXISTS UniqueCategories;\n\nCREATE OR REPLACE TEMPORARY VIEW UniqueCategories AS\n  SELECT DISTINCT explode(categories) AS category \n  FROM DatabricksBlog","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6102bba3-6a73-4bf7-8c73-ac2e76be26cb"},{"version":"CommandV1","origId":1745794912676033,"guid":"bc6c92c1-0a9d-4cea-b493-256056691782","subtype":"command","commandType":"auto","position":51.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nresultsCount = spark.sql(\"SELECT category FROM UniqueCategories order by category\")\n\ndbTest(\"SQL-L5-uniqueCategories-count\", 12, resultsCount.count())\n\nresults = [r[0] for r in resultsCount.collect()]\ndbTest(\"SQL-L5-uniqueCategories-0\", \"Announcements\", results[0])\ndbTest(\"SQL-L5-uniqueCategories-1\", \"Apache Spark\", results[1])\ndbTest(\"SQL-L5-uniqueCategories-2\", \"Company Blog\", results[2])\n\ndbTest(\"SQL-L5-uniqueCategories-9\", \"Platform\", results[9])\ndbTest(\"SQL-L5-uniqueCategories-10\", \"Product\", results[10])\ndbTest(\"SQL-L5-uniqueCategories-11\", \"Streaming\", results[11])\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"71588ace-c541-472d-9a29-6625c9e2c501"},{"version":"CommandV1","origId":1745794912676034,"guid":"b704636f-c0a1-4caa-95d5-dafaa30c9f28","subtype":"command","commandType":"auto","position":52.0,"command":"%md\n### Step 2\nShow the complete list of categories.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0bcd2432-c886-46ea-a8f8-72cddc090050"},{"version":"CommandV1","origId":1745794912676035,"guid":"e05b09ea-57b2-46aa-b5d3-b68c489b80f6","subtype":"command","commandType":"auto","position":53.0,"command":"%sql\n-- ANSWER\n\nSELECT * \nFROM UniqueCategories \nORDER BY category","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"85fcc2f7-cae4-4239-ad93-e0f1af5b89a2"},{"version":"CommandV1","origId":1745794912676036,"guid":"a30a7fe3-b9cc-46f7-8014-93b316f45fa1","subtype":"command","commandType":"auto","position":54.0,"command":"%md\n## Exercise 3\n\nCount how many times each category is referenced in the Databricks blog.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7d67c6a8-aad0-4341-9b33-5acc39680620"},{"version":"CommandV1","origId":1745794912676037,"guid":"8d751fbe-cfa6-44ff-a0d2-f3698a8784e2","subtype":"command","commandType":"auto","position":55.0,"command":"%md-sandbox\n### Step 1\n\nStarting with the table `DatabricksBlog`, create a temporary view called `TotalArticlesByCategory` where:\n0. The new table contains two columns, `category` and `total`\n0. The `category` column is a single, distinct category (similar to the last exercise)\n0. The `total` column is the total number of articles in that category\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** You need either multiple views or a `LATERAL VIEW` to solve this.\n\n<img alt=\"Side Note\" title=\"Side Note\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.05em; transform:rotate(15deg)\" src=\"https://files.training.databricks.com/static/images/icon-note.webp\"/> Because articles can be tagged with multiple categories, the sum of the totals adds up to more than the total number of articles.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"166ab5b0-66bd-46b5-971c-d34c23a5024c"},{"version":"CommandV1","origId":1745794912676038,"guid":"ee870402-9dee-4cd8-a4ec-35d6b6008274","subtype":"command","commandType":"auto","position":56.0,"command":"%sql\n-- ANSWER\n\nDROP TABLE IF EXISTS TotalArticlesByCategory;\n\nCREATE OR REPLACE TEMPORARY VIEW TotalArticlesByCategory AS\n  SELECT category, \n         count(category) AS total \n  FROM DatabricksBlog\n  LATERAL VIEW explode(categories) AS category\n  GROUP BY category","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6794ec0c-1b55-42ab-b6cb-59484146e932"},{"version":"CommandV1","origId":1745794912676039,"guid":"ed961bd3-d2c3-4954-9fd5-c4dd84fb2bfb","subtype":"command","commandType":"auto","position":57.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nresultsDF = spark.sql(\"SELECT category, total FROM TotalArticlesByCategory ORDER BY category\")\ndbTest(\"SQL-L5-articlesByCategory-count\", 12, resultsDF.count())\n\nresults = [ (r[0]+\" w/\"+str(r[1])) for r in resultsDF.collect()]\n\ndbTest(\"SQL-L5-articlesByCategory-0\", \"Announcements w/72\", results[0])\ndbTest(\"SQL-L5-articlesByCategory-1\", \"Apache Spark w/132\", results[1])\ndbTest(\"SQL-L5-articlesByCategory-2\", \"Company Blog w/224\", results[2])\n\ndbTest(\"SQL-L5-articlesByCategory-9\", \"Platform w/4\", results[9])\ndbTest(\"SQL-L5-articlesByCategory-10\", \"Product w/83\", results[10])\ndbTest(\"SQL-L5-articlesByCategory-11\", \"Streaming w/21\", results[11])\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"01423e7c-6b46-4567-9e18-d851108bdc01"},{"version":"CommandV1","origId":1745794912676040,"guid":"d0a46a4f-141d-4a9b-bc85-09d4442efbe6","subtype":"command","commandType":"auto","position":58.0,"command":"%md\n### Step 2\nDisplay the totals of each category, order by `category`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4442229c-2c64-40ea-9021-fb80267ef727"},{"version":"CommandV1","origId":1745794912676041,"guid":"c4ea1956-817f-409c-8fc2-6365ab53e1ce","subtype":"command","commandType":"auto","position":59.0,"command":"%sql\n-- ANSWER\n\nSELECT * \nFROM TotalArticlesByCategory \nORDER BY category","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"744832e8-6ade-4442-8536-57722072caab"},{"version":"CommandV1","origId":1745794912676042,"guid":"dce79daa-d42a-484d-bd1e-132e0f1d83ad","subtype":"command","commandType":"auto","position":60.0,"command":"%md\n## Summary\n\n* Spark SQL allows you to query and manipulate structured and semi-structured data\n* Spark SQL's built-in functions provide powerful primitives for querying complex schemas","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c3f08620-0dd2-48a7-92ac-5ba306f34089"},{"version":"CommandV1","origId":1745794912676043,"guid":"498a5f61-a029-46b3-a496-aaf5481f6011","subtype":"command","commandType":"auto","position":61.0,"command":"%md\n## Review Questions\n**Q:** What is the syntax for accessing nested columns?  \n**A:** Use the dot notation: ```SELECT dates.publishedOn```\n\n**Q:** What is the syntax for accessing the first element in an array?  \n**A:** Use the [subscript] notation:  ```SELECT authors[0]```\n\n**Q:** What is the syntax for expanding an array into multiple rows?  \n**A:** Use the explode keyword, either:  \n```SELECT explode(authors) as Author``` or  \n```LATERAL VIEW explode(authors) exploded_authors_view AS author```","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5fd75537-3eab-4ac8-968c-d52cb27c0bb7"},{"version":"CommandV1","origId":1745794912676044,"guid":"cf3be390-125b-44fc-aefb-78b0715d4753","subtype":"command","commandType":"auto","position":62.0,"command":"%md\n## Next Steps\n\nStart the next lesson, [Querying Data Lakes with SQL]($./06S-Data-Lakes).","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b9300827-259c-4ca3-badf-0db69774cdcf"},{"version":"CommandV1","origId":1745794912676045,"guid":"af020168-afdf-42ab-9c2c-782230dcfa6d","subtype":"command","commandType":"auto","position":63.0,"command":"%md\n## Additional Topics & Resources\n\n* <a href=\"https://docs.databricks.com/spark/latest/spark-sql/index.html\" target=\"_blank\">Spark SQL Reference</a>\n* <a href=\"http://spark.apache.org/docs/latest/sql-programming-guide.html\" target=\"_blank\">Spark SQL, DataFrames and Datasets Guide</a>\n* <a href=\"https://stackoverflow.com/questions/36876959/sparksql-can-i-explode-two-different-variables-in-the-same-query\" target=\"_blank\">SparkSQL: Can I explode two different variables in the same query? (StackOverflow)</a>","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7263eaf5-a9c1-4fce-9d2c-de34e6157a08"}],"dashboards":[],"guid":"d2475922-1f49-4abf-bc06-a7b743a48936","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}