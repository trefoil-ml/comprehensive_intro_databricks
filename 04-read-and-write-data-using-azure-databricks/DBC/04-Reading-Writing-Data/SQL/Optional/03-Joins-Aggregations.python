{"version":"NotebookV1","origId":1745794912676557,"name":"03-Joins-Aggregations","language":"python","commands":[{"version":"CommandV1","origId":1745794912676558,"guid":"50630105-bb97-46a3-94e0-f7c05d9986dc","subtype":"command","commandType":"auto","position":2.0,"command":"%md\n# Challenge Exercises","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2156ccde-5dbf-4713-a6ac-b616c099b09a"},{"version":"CommandV1","origId":1745794912676559,"guid":"3637f08a-f94f-4978-a9ca-9f8e7e83ba78","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n### Getting Started\n\nRun the following cell to configure our \"classroom\".","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e6f0c767-9594-4aa1-9251-e03cec1892da"},{"version":"CommandV1","origId":1745794912676560,"guid":"3ab8a5b5-8fd0-47bb-b78a-beeef79c2e06","subtype":"command","commandType":"auto","position":4.0,"command":"%run \"../Includes/Classroom-Setup\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"04eae3a1-edc6-40f7-b81f-e4a10eb9c4b8"},{"version":"CommandV1","origId":1745794912676561,"guid":"46cf2ae9-39c7-4835-8851-052e73d5d19d","subtype":"command","commandType":"auto","position":5.0,"command":"%md\n## Challenge Exercise 3\n\nUse the `SSANames` table to find the most popular first name for girls in 1885, 1915, 1945, 1975, and 2005.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f30765aa-8c9f-4494-a296-bd78ed79bc9c"},{"version":"CommandV1","origId":1745794912676562,"guid":"f32dc743-d3c6-468c-9c00-122b0450a510","subtype":"command","commandType":"auto","position":6.0,"command":"%md-sandbox\n### Step 1\nCreate a temporary view called `HistoricNames` where:\n0. The table `HistoricNames` is created using a **single** SQL query.\n0. The result has three columns:\n  * `firstName`\n  * `year`\n  * `total`\n\n<img alt=\"Hint\" title=\"Hint\" style=\"vertical-align: text-bottom; position: relative; height:1.75em; top:0.3em\" src=\"https://files.training.databricks.com/static/images/icon-light-bulb.svg\"/>&nbsp;**Hint:** Explore the data before crafting your solution.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0e681382-5122-41c6-8940-7365e9326624"},{"version":"CommandV1","origId":1745794912676563,"guid":"1a5b8beb-b476-4f06-81f8-aadf86dd5bf7","subtype":"command","commandType":"auto","position":7.0,"command":"%sql\n-- ANSWER\n\nCREATE OR REPLACE TEMPORARY VIEW HistoricNames AS\nSELECT firstName, year, total\nFROM SSANames\nNATURAL INNER JOIN (\n  SELECT year, gender, max(total) AS total\n  FROM  SSANames\n  GROUP BY year, gender\n) AS max_names\nWHERE gender='F' AND year IN (1885, 1915, 1945, 1975, 2005)\nORDER BY year","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"af555590-1865-4cad-bfff-de718cb2fb6b"},{"version":"CommandV1","origId":1745794912676564,"guid":"06adedfc-a4e6-4112-88a6-24b44fdb7c5a","subtype":"command","commandType":"auto","position":8.0,"command":"%python\n# TEST - Run this cell to test your solution.\n\nresultsDF = spark.sql(\"select firstName, year, total from HistoricNames order by total\")\nresults = [ (r[0]+\" \"+str(r[1])+\": \"+str(r[2])) for r in resultsDF.collect()]\n\ndbTest(\"SQL-L3-Opt-historicNames-0\", \"Mary 1885: 9128\", results[0])\ndbTest(\"SQL-L3-Opt-historicNames-1\", \"Emily 2005: 23928\", results[1])\ndbTest(\"SQL-L3-Opt-historicNames-2\", \"Jennifer 1975: 58185\", results[2])\ndbTest(\"SQL-L3-Opt-historicNames-3\", \"Mary 1915: 58187\", results[3])\ndbTest(\"SQL-L3-Opt-historicNames-4\", \"Mary 1945: 59284\", results[4])\n\nprint(\"Tests passed!\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b8a0b09c-7e42-44bd-aa0d-260816c51c73"},{"version":"CommandV1","origId":1745794912676565,"guid":"78531005-edf5-436e-8a94-7476e1355c0f","subtype":"command","commandType":"auto","position":9.0,"command":"%md\n### Step 2\nDisplay the table `HistoricNames`.","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"04431cf5-1553-4af9-9bcb-87e2f6a37a53"},{"version":"CommandV1","origId":1745794912676566,"guid":"0b677d5d-8195-4bf7-8da2-0bf9f65ef34b","subtype":"command","commandType":"auto","position":10.0,"command":"%sql\n-- ANSWER\n\nSELECT * FROM HistoricNames","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"4258953226069350","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4a169fc4-25d1-43c0-8699-5e8981bb1829"}],"dashboards":[],"guid":"283df989-ba34-415b-9ed7-9fa5930cc31d","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}